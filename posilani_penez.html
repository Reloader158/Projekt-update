<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>RP – Posílání peněz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FontAwesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer">

  <style>
    :root {
      --bottom-bar-height: 65px;
      --bottom-icon-box: 60px;
      --bottom-icon-font: 50px;
      --blue: #2876de;
      --orange: #ff8a2b;
      --grey-bg: #f3f5f7;
    }

    * , *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .mobile-frame {
      width: 420px;
      height: 95vh;
      max-height: 860px;
      border-radius: 36px;
      background: #000;
      box-shadow: 0 22px 50px rgba(0,0,0,0.7);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .app-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f4f4f4;
      height: 100%;
      position: relative;
    }

    /* HORNÍ LIŠTA */
    .app-header {
      height: 70px;
      background: var(--blue);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      flex-shrink: 0;
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #fff;
    }

    .logo-img { height: 50px; }

    .hamburger {
      width: 28px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .hamburger span {
      height: 3px;
      border-radius: 999px;
      background: #fff;
    }

    /* HLAVNÍ OBSAH */
    .app-content {
      flex: 1 1 auto;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 14px 14px 10px;
      background: var(--grey-bg);
    }

    /* ZŮSTATEK */
    .card {
      background: #fff;
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      margin-bottom: 14px;
    }

    .card-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 14px;
      color: #9e9e9e;
      font-size: 26px;
      cursor: pointer;
    }

    .card-text-main { display: flex; flex-direction: column; gap: 3px; }

    .card-label  { font-size: 18px; color: #b5b5b5; }
    .card-amount { font-size: 22px; color: #ff7a28; font-weight: 600; }

    @keyframes spin-refresh {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    .card-icon i.spinning { animation: spin-refresh 0.45s linear 3; }

    /* PANEL POSLAT PENÍZE */
    .send-panel {
      margin-top: 18px;
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }

    .send-title {
      margin: 0 0 4px;
      font-size: 20px;
      font-weight: 600;
    }

    .send-sub {
      margin: 0 0 18px;
      font-size: 13px;
      color: #777;
    }

    /* TABY */
    .send-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .send-tab {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      padding: 8px 10px;
      font-size: 13px;
      font-weight: 600;
      background: #f5f5f5;
      color: #666;
      cursor: pointer;
      text-align: center;
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    .send-tab.active {
      background: var(--blue);
      border-color: var(--blue);
      color: #fff;
      box-shadow: 0 2px 6px rgba(40,118,222,0.35);
    }

    .field-label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .field-helper {
      font-size: 11px;
      color: #777;
      margin: 2px 0 10px;
    }

    .input-row {
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 6px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fafafa;
      margin-bottom: 6px;
    }

    .input-row.focused {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.2);
    }

    .input-prefix {
      font-size: 13px;
      color: #777;
      white-space: nowrap;
    }

    .text-input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 15px;
      outline: none;
    }

    .text-input::placeholder {
      color: #bbb;
    }

    .status-pill {
      margin-top: 8px;
      border-radius: 999px;
      font-size: 12px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-pill.ok {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .status-pill.err {
      background: #ffebee;
      color: #c62828;
    }

    .status-pill i {
      font-size: 13px;
    }

    .btn-inline {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 12px;
      font-weight: 600;
      background: var(--blue);
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-inline:disabled {
      background: #cfd8e5;
      cursor: default;
    }

    /* ČÁSTKA */
    .amount-wrapper {
      border-radius: 999px;
      border: 1px solid #ff8a2b;
      padding: 6px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fffdf8;
      margin: 10px 0 6px;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .amount-currency {
      font-size: 14px;
      font-weight: 600;
      color: #ff8a2b;
      white-space: nowrap;
    }

    .amount-input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 18px;
      font-weight: 600;
      outline: none;
      text-align: right;
      padding-right: 10px;
    }

    .amount-input::placeholder {
      color: #ccc;
      font-weight: 400;
    }

    .amount-error {
      font-size: 12px;
      color: #e53935;
      margin-bottom: 4px;
      display: none;
    }

    .amount-error.visible { display: block; }

    /* Extra pole pro bankovní převod – vždy viditelné */
    .bank-extra {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #f0f0f0;
    }

    .bank-extra-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 10px;
      margin-bottom: 10px;
    }

    .small-input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ddd;
      padding: 6px 10px;
      font-size: 13px;
      outline: none;
    }

    .small-input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.2);
    }

    .bank-extra-grid .full-width {
      grid-column: 1 / -1;
    }

    /* ODESLAT */
    .btn-main {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 11px 18px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: var(--blue);
      color: #ffffff;
      transition: opacity 0.15s ease, transform 0.05s ease, background 0.15s ease;
    }

    .btn-main:active:not(.btn-disabled) { transform: scale(0.98); }

    .btn-main.btn-disabled {
      background: #cfd8e5;
      cursor: default;
      opacity: 0.85;
    }

    /* SPODNÍ LIŠTA */
    .bottom-bar {
      height: var(--bottom-bar-height);
      background: var(--blue);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0 8px;
      flex-shrink: 0;
    }

    .bottom-link {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .bottom-icon-inner {
      width: var(--bottom-icon-box);
      height: var(--bottom-icon-box);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: var(--bottom-icon-font);
    }

    .bottom-icon-inner.plus-icon { background: transparent; }

    .plus-box {
      width: 45px;
      height: 45px;
      border-radius: 10px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .plus-box i {
      color: #2876de;
      font-size: 26px;
    }

    /* MENU ŘÁDKY – Přehled / Transakce / Karty / Notifikace */
    .menu-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .menu-item {
      background: #fff;
      border-radius: 18px;
      padding: 12px 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
    }

    .menu-left {
      display: flex;
      align-items: center;
      width: 100%;
      gap: 16px;
    }

    .menu-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 26px;
      flex-shrink: 0;
      position: relative;
    }

    .menu-icon.search { background: #2f7eea; }
    .menu-icon.coins  { background: #2fb2ff; }
    .menu-icon.minus  { background: #32d1a2; }
    .menu-icon.bell   { background: #ff8b39; }

    .menu-label {
      font-size: 18px;
      color: #111;
      margin-left: auto;
      text-align: right;
    }

    /* TOAST notifikace (tady jen malé info bubliny) */
    .toast {
      position: absolute;
      left: 50%;
      bottom: calc(var(--bottom-bar-height) + 14px);
      transform: translateX(-50%);
      background: #323232;
      color: #fff;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 50;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -4px);
    }

    /* MODAL – ověření platby (PIN + Face ID) */
    .auth-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
    }

    .auth-backdrop.visible {
      display: flex;
    }

    .auth-modal {
      width: 85%;
      max-width: 360px;
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }

    .auth-title {
      margin: 0 0 4px;
      font-size: 18px;
      font-weight: 600;
    }

    .auth-sub {
      margin: 0 0 14px;
      font-size: 13px;
      color: #666;
    }

    .auth-pin-input {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #ddd;
      padding: 8px 10px;
      font-size: 18px;
      text-align: center;
      letter-spacing: 4px;
      outline: none;
    }

    .auth-pin-input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.25);
    }

    .auth-error {
      margin-top: 6px;
      font-size: 12px;
      color: #c62828;
      min-height: 16px;
    }

    .auth-actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn-secondary {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: #eceff1;
      color: #333;
    }

    .btn-secondary:active {
      transform: scale(0.98);
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: var(--blue);
      color: #fff;
    }

    .btn-primary:active {
      transform: scale(0.98);
    }

    .face-step {
      text-align: center;
      padding-top: 6px;
    }

    .face-icon {
      font-size: 42px;
      color: var(--blue);
      margin-bottom: 10px;
    }

    .face-text {
      font-size: 13px;
      color: #555;
      margin-bottom: 12px;
    }

    /* BADGE + stav pro Notifikace (stejně jako ve vkladu) */
    .notif-badge {
      position: absolute;
      right: 4px;
      bottom: 4px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: #ff3b30;
      color: #ffffff;
      font-size: 10px;
      font-weight: 700;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px #ffffff;
    }

    .menu-item.notifications.disabled {
      pointer-events: none;
    }

    .menu-item.notifications.enabled {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="mobile-frame">
    <div class="app-screen">

      <!-- HORNÍ LIŠTA -->
      <header class="app-header">
        <div class="logo-wrap">
          <img src="https://rychlapenezenka.cz/images/rp_cerna-bila.png" alt="RP logo" class="logo-img">
        </div>
        <div class="hamburger">
          <span></span><span></span><span></span>
        </div>
      </header>

      <!-- OBSAH -->
      <main class="app-content">

        <!-- ZŮSTATEK -->
        <section class="card">
          <div class="card-icon">
            <i class="fa-solid fa-arrows-rotate"></i>
          </div>
          <div class="card-text-main">
            <div class="card-label">Váš zůstatek</div>
            <div class="card-amount" id="balanceAmount">262.12 CZK</div>
          </div>
        </section>

        <!-- Menu položky (informativní, jako jinde) -->
        <section class="menu-list">
          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon search">
                <i class="fa-solid fa-magnifying-glass"></i>
              </div>
              <div class="menu-label">Přehled</div>
            </div>
          </div>

          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon coins">
                <i class="fa-solid fa-coins"></i>
              </div>
              <div class="menu-label">Transakce</div>
            </div>
          </div>

          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon minus">
                <i class="fa-solid fa-credit-card"></i>
              </div>
              <div class="menu-label">Karty</div>
            </div>
          </div>

          <!-- Notifikace s badge + stavem disabled/enabled -->
          <div class="menu-item notifications disabled" id="notificationsRow">
            <div class="menu-left">
              <div class="menu-icon bell">
                <i class="fa-solid fa-bell"></i>
                <span class="notif-badge" id="notifBadge">1</span>
              </div>
              <div class="menu-label">Notifikace</div>
            </div>
          </div>
        </section>


        <!-- PANEL POSLAT PENÍZE -->
        <section class="send-panel">
          <h1 class="send-title">Poslat peníze</h1>
          <p class="send-sub">
            Disponibilní zůstatek: <strong id="sendBalance">262,12 CZK</strong>
          </p>

          <!-- TABY -->
          <div class="send-tabs">
            <button class="send-tab active" id="tabWallet">Mezi peněženkami</button>
            <button class="send-tab" id="tabBank">Na bankovní účet</button>
          </div>

          <!-- MEZI PENĚŽENKAMI -->
          <div id="walletSection">
            <div class="field-label">Příjemce</div>
            <div class="input-row" id="walletRow">
              <span class="input-prefix">@</span>
              <input
                id="walletRecipient"
                class="text-input"
                type="email"
                placeholder="e-mail příjemce nebo telefon">
              <button id="btnCheckRecipient" class="btn-inline">Zkontrolovat</button>
            </div>
            <div id="walletStatus"></div>

            <div class="field-label" style="margin-top:16px;">Částka</div>
            <div class="amount-wrapper">
              <span class="amount-currency">CZK</span>
              <input
                id="walletAmount"
                class="amount-input"
                type="tel"
                inputmode="numeric"
                placeholder="0,00">
            </div>
            <div id="walletAmountError" class="amount-error">
              Nemůžete poslat víc než je zůstatek Vaší peněženky.
            </div>
            <div class="field-helper">
              Maximálně do výše zůstatku Vaší peněženky.
            </div>
          </div>

          <!-- NA BANKOVNÍ ÚČET -->
          <div id="bankSection" style="display:none;">

            <div class="field-label">Číslo účtu</div>
            <div class="input-row">
              <span class="input-prefix">
                <i class="fa-solid fa-building-columns"></i>
              </span>
              <input
                id="bankAccount"
                class="text-input"
                type="text"
                placeholder="1234567890">
            </div>

            <div class="field-label">Kód banky</div>
            <div class="input-row">
              <span class="input-prefix">kód</span>
              <input
                id="bankCode"
                class="text-input"
                type="text"
                placeholder="0800">
            </div>

            <div class="bank-extra" id="bankExtra">
              <div class="bank-extra-grid">
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Jméno / název příjemce</div>
                  <input id="bankRecipientName" class="small-input" type="text" placeholder="Jméno nebo název společnosti">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Variabilní symbol</div>
                  <input id="vsInput" class="small-input" type="text" placeholder="VS">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Specifický symbol</div>
                  <input id="ssInput" class="small-input" type="text" placeholder="SS">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Konstantní symbol</div>
                  <input id="ksInput" class="small-input" type="text" placeholder="KS">
                </div>
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Poznámka pro příjemce</div>
                  <input id="msgRecipientInput" class="small-input" type="text" placeholder="Zpráva na výpisu příjemce">
                </div>
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Poznámka pro mě</div>
                  <input id="msgMeInput" class="small-input" type="text" placeholder="Interní poznámka (viditelná jen pro vás)">
                </div>
              </div>

              <div class="field-label">Částka</div>
              <div class="amount-wrapper">
                <span class="amount-currency">CZK</span>
                <input
                  id="bankAmount"
                  class="amount-input"
                  type="tel"
                  inputmode="numeric"
                  placeholder="0,00">
              </div>
              <div id="bankAmountError" class="amount-error">
                Nemůžete poslat víc než je zůstatek Vaší peněženky.
              </div>
            </div>
          </div>

          <!-- SPOLEČNÉ TLAČÍTKO -->
          <button id="btnSend" class="btn-main btn-disabled" disabled>
            Pokračovat
          </button>

        </section>
      </main>

      <!-- TOAST NOTIFIKACE -->
      <div id="toast" class="toast"></div>

      <!-- MODAL – ověření platby -->
      <div id="authBackdrop" class="auth-backdrop">
        <div class="auth-modal">
          <!-- KROK 1: PIN -->
          <div id="pinStep">
            <h2 class="auth-title">Ověření platby</h2>
            <p class="auth-sub">Zadejte PIN k peněžence.</p>
            <input
              id="pinInput"
              class="auth-pin-input"
              type="password"
              inputmode="numeric"
              maxlength="4"
              autocomplete="off"
              placeholder="••••">
            <div id="pinError" class="auth-error"></div>
            <div class="auth-actions">
              <button id="btnAuthCancel1" class="btn-secondary">Zrušit</button>
              <button id="btnPinOk" class="btn-primary">Potvrdit PIN</button>
            </div>
          </div>

          <!-- KROK 2: Face ID -->
          <div id="faceStep" style="display:none;">
            <h2 class="auth-title">Ověření Face ID</h2>
            <div class="face-step">
              <div class="face-icon">
                <i class="fa-regular fa-face-smile"></i>
              </div>
              <p class="face-text">
                Podívejte se na obrazovku pro ověření Face ID (demo).
              </p>
            </div>
            <div class="auth-actions">
              <button id="btnAuthCancel2" class="btn-secondary">Zrušit</button>
              <button id="btnFaceOk" class="btn-primary">Ověřit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SPODNÍ LIŠTA -->
      <nav class="bottom-bar">
        <a href="prehled.html" class="bottom-link">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-money-bill-transfer"></i>
          </div>
        </a>

        <a href="vlozit.html" class="bottom-link">
          <div class="bottom-icon-inner plus-icon">
            <div class="plus-box">
              <i class="fa-solid fa-plus"></i>
            </div>
          </div>
        </a>

        <a href="posilani_penez.html" class="bottom-link">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-hand-holding-dollar"></i>
          </div>
        </a>

        <a href="sporeni.html" class="bottom-link">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-piggy-bank"></i>
          </div>
        </a>
      </nav>

    </div>
  </div>

  <script>
    // jednoduchý zůstatek
    let currentBalance = 262.12;
    const balanceAmountEl = document.getElementById("balanceAmount");
    const sendBalanceEl   = document.getElementById("sendBalance");

    // NOTIFIKACE – badge u zvonku (stejné jako u vkladu)
    const notifBadge        = document.getElementById("notifBadge");
    const notificationsRow  = document.getElementById("notificationsRow");
    let notifCount = 0;

    function showNewNotification() {
      notifCount += 1;
      if (notifBadge) {
        notifBadge.textContent = notifCount;
        notifBadge.style.display = "flex";
      }
      enableNotificationsRow();
    }

    function enableNotificationsRow() {
      if (!notificationsRow) return;
      notificationsRow.classList.remove("disabled");
      notificationsRow.classList.add("enabled");

      // jen jednou – po prvním odemknutí
      notificationsRow.addEventListener("click", () => {
        window.location.href = "notifikace_od_plateb.html";
      }, { once: true });
    }

    // MODAL – ověření platby
    const authBackdrop   = document.getElementById("authBackdrop");
    const pinStep        = document.getElementById("pinStep");
    const faceStep       = document.getElementById("faceStep");
    const pinInput       = document.getElementById("pinInput");
    const pinError       = document.getElementById("pinError");
    const btnPinOk       = document.getElementById("btnPinOk");
    const btnFaceOk      = document.getElementById("btnFaceOk");
    const btnAuthCancel1 = document.getElementById("btnAuthCancel1");
    const btnAuthCancel2 = document.getElementById("btnAuthCancel2");

    let pendingTransaction = null; // { mode: 'wallet' | 'bank', amount: number }

    function formatAmountCZK(amount) {
      return amount.toLocaleString("cs-CZ", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function renderBalance() {
      const formatted = formatAmountCZK(currentBalance);
      if (balanceAmountEl) balanceAmountEl.textContent = formatted + " CZK";
    }
    renderBalance(); // horní zůstatek hned po načtení

    // toast notifikace (malý info bublina)
    function showNotification(message) {
      const toast = document.getElementById("toast");
      if (!toast) {
        alert(message);
        return;
      }
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }

    // MODAL flow
    function openAuthFlow(mode, amount) {
      pendingTransaction = { mode, amount };
      // krok 1 – PIN
      pinStep.style.display  = "";
      faceStep.style.display = "none";
      pinInput.value = "";
      pinError.textContent = "";
      authBackdrop.classList.add("visible");
      setTimeout(() => pinInput.focus(), 50);
    }

    function closeAuthFlow() {
      authBackdrop.classList.remove("visible");
      pendingTransaction = null;
    }

    function goToFaceStep() {
      pinStep.style.display  = "none";
      faceStep.style.display = "";
    }

    btnAuthCancel1.addEventListener("click", closeAuthFlow);
    btnAuthCancel2.addEventListener("click", closeAuthFlow);

    // Demo PIN – 1234
    btnPinOk.addEventListener("click", () => {
      const val = pinInput.value.trim();
      if (val === "1234") {
        pinError.textContent = "";
        goToFaceStep();
      } else {
        pinError.textContent = "Nesprávný PIN (demo: 1234).";
        pinInput.value = "";
        pinInput.focus();
      }
    });

    pinInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        btnPinOk.click();
      }
    });

    // TABY
    const tabWallet   = document.getElementById("tabWallet");
    const tabBank     = document.getElementById("tabBank");
    const walletSec   = document.getElementById("walletSection");
    const bankSec     = document.getElementById("bankSection");
    const btnSend     = document.getElementById("btnSend");

    function setMode(mode) {
      if (mode === "wallet") {
        tabWallet.classList.add("active");
        tabBank.classList.remove("active");
        walletSec.style.display = "";
        bankSec.style.display   = "none";
      } else {
        tabWallet.classList.remove("active");
        tabBank.classList.add("active");
        walletSec.style.display = "none";
        bankSec.style.display   = "";
      }
      updateSendState();
    }

    tabWallet.addEventListener("click", () => setMode("wallet"));
    tabBank.addEventListener("click",   () => setMode("bank"));

    // MEZI PENĚŽENKAMI
    const walletRecipient   = document.getElementById("walletRecipient");
    const walletAmount      = document.getElementById("walletAmount");
    const walletStatusBox   = document.getElementById("walletStatus");
    const walletRow         = document.getElementById("walletRow");
    const btnCheck          = document.getElementById("btnCheckRecipient");
    const walletAmountError = document.getElementById("walletAmountError");

    let walletRecipientOk = false;

    btnCheck.addEventListener("click", () => {
      const val = walletRecipient.value.trim();
      walletRecipientOk = false;
      walletStatusBox.innerHTML = "";

      if (!val) return;

      // DEMO logika: pokud obsahuje zavináč → považujeme za existujícího klienta
      if (val.includes("@")) {
        walletRecipientOk = true;
        walletStatusBox.innerHTML =
          '<div class="status-pill ok"><i class="fa-solid fa-circle-check"></i>' +
          'Příjemce ověřen – demo uživatel</div>';
      } else {
        walletStatusBox.innerHTML =
          '<div class="status-pill err"><i class="fa-solid fa-circle-exclamation"></i>' +
          'Příjemce se nepodařilo ověřit.</div>';
      }

      updateSendState();
    });

    // BANKOVNÍ PŘEVOD
    const bankAccount     = document.getElementById("bankAccount");
    const bankCode        = document.getElementById("bankCode");
    const bankAmount      = document.getElementById("bankAmount");
    const bankAmountError = document.getElementById("bankAmountError");
    const bankRecipientName = document.getElementById("bankRecipientName"); // ← NOVÉ

    // FOKUS efekty
    const inputRows = document.querySelectorAll(".input-row");
    inputRows.forEach(row => {
      const input = row.querySelector(".text-input");
      if (!input) return;
      input.addEventListener("focus", () => row.classList.add("focused"));
      input.addEventListener("blur",  () => row.classList.remove("focused"));
    });

    function parseAmount(value) {
      const cleaned = value.replace(/\s/g, "").replace(",", ".");
      const num = parseFloat(cleaned);
      return isNaN(num) ? 0 : num;
    }

    // Disponibilní zůstatek dole – podle částky a režimu
    function renderAvailableBalance() {
      if (!sendBalanceEl) return;

      const walletMode = tabWallet.classList.contains("active");
      let available = currentBalance;
      let amt = 0;

      if (walletMode && walletAmount) {
        amt = parseAmount(walletAmount.value.trim());
      } else if (!walletMode && bankAmount) {
        amt = parseAmount(bankAmount.value.trim());
      }

      if (amt > 0) {
        const used = Math.min(amt, currentBalance);
        available = currentBalance - used;
      }

      sendBalanceEl.textContent = formatAmountCZK(available) + " CZK";
    }

    function updateSendState() {
      const walletMode = tabWallet.classList.contains("active");
      let enabled = false;

      if (walletMode) {
        const amt = parseAmount(walletAmount.value.trim());
        if (walletAmountError) {
          walletAmountError.classList.toggle("visible", amt > currentBalance && amt > 0);
        }
        enabled = walletRecipientOk && amt > 0 && amt <= currentBalance;
      } else {
        const amt = parseAmount(bankAmount.value.trim());
        const hasAccount  = bankAccount.value.trim().length > 0;
        const hasBankCode = bankCode.value.trim().length > 0;
        const hasRecipientName = bankRecipientName.value.trim().length > 1; // ← NOVÉ

        if (bankAmountError) {
          bankAmountError.classList.toggle("visible", amt > currentBalance && amt > 0);
        }
        // tlačítko se rozsvítí jen když je vyplněné číslo účtu, kód banky, jméno příjemce a částka v limitu
        enabled = hasAccount && hasBankCode && hasRecipientName && amt > 0 && amt <= currentBalance;
      }

      // přepočet disponibilního zůstatku při každé změně
      renderAvailableBalance();

      if (enabled) {
        btnSend.disabled = false;
        btnSend.classList.remove("btn-disabled");
      } else {
        btnSend.disabled = true;
        btnSend.classList.add("btn-disabled");
      }
    }

    walletRecipient.addEventListener("input", () => {
      walletRecipientOk = false;
      walletStatusBox.innerHTML = "";
      updateSendState();
    });
    walletAmount.addEventListener("input", updateSendState);
    bankAccount.addEventListener("input", updateSendState);
    bankCode.addEventListener("input", updateSendState);
    bankAmount.addEventListener("input", updateSendState);
    bankRecipientName.addEventListener("input", updateSendState); // ← NOVÉ


    // dokončení transakce po Face ID
    function performTransaction(mode, amt) {
      if (amt <= 0 || amt > currentBalance) {
        updateSendState();
        return;
      }

      currentBalance = Math.max(0, currentBalance - amt);
      renderBalance();
      renderAvailableBalance();

      if (mode === "wallet") {
        showNotification("Demo: odesláno " + formatAmountCZK(amt) + " CZK jiné peněžence RP.");
      } else {
        showNotification("Demo: odesláno " + formatAmountCZK(amt) + " CZK na bankovní účet.");
      }

      // vyčištění polí
      if (mode === "wallet") {
        walletAmount.value = "";
        walletRecipientOk = false;
        walletStatusBox.innerHTML = "";
      } else {
        bankAmount.value = "";
      }

      // vytvořit novou notifikaci (badge + odemknout řádek)
      showNewNotification();

      updateSendState();
    }

    btnFaceOk.addEventListener("click", () => {
      if (!pendingTransaction) {
        closeAuthFlow();
        return;
      }
      // po "Face ID" dokončíme transakci
      performTransaction(pendingTransaction.mode, pendingTransaction.amount);
      closeAuthFlow();
    });

    // Klik na Pokračovat – spustí ověřovací flow (PIN + Face ID)
    btnSend.addEventListener("click", () => {
      if (btnSend.disabled) return;

      const walletMode = tabWallet.classList.contains("active");
      let amt = 0;

      if (walletMode) {
        amt = parseAmount(walletAmount.value.trim());
      } else {
        amt = parseAmount(bankAmount.value.trim());
      }

      if (amt <= 0 || amt > currentBalance) {
        updateSendState();
        return;
      }

      openAuthFlow(walletMode ? "wallet" : "bank", amt);
    });

    // animace šipky
    const refreshWrapper = document.querySelector(".card-icon");
    const refreshIcon    = refreshWrapper ? refreshWrapper.querySelector("i") : null;

    if (refreshWrapper && refreshIcon) {
      refreshWrapper.addEventListener("click", () => {
        if (refreshIcon.classList.contains("spinning")) return;
        refreshIcon.classList.add("spinning");
        refreshIcon.addEventListener(
          "animationend",
          () => refreshIcon.classList.remove("spinning"),
          { once: true }
        );
      });
    }

    // inicializace disponibilního zůstatku po načtení
    renderAvailableBalance();
  </script>
</body>
</html>
