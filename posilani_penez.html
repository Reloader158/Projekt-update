<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>RP ‚Äì Pos√≠l√°n√≠ penƒõz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- FontAwesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer">

  <style>
    :root {
      --bottom-bar-height: 65px;
      --bottom-icon-box: 60px;
      --bottom-icon-font: 50px;
      --blue: #2876de;
      --orange: #ff8a2b;
      --grey-bg: #f3f5f7;
      --green: #32d180;
    }

    * , *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
    }

    .mobile-frame {
      width: 420px;
      height: 95vh;
      max-height: 860px;
      border-radius: 36px;
      background: #000;
      box-shadow: 0 22px 50px rgba(0,0,0,0.7);
      overflow: hidden;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .app-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f4f4f4;
      height: 100%;
      position: relative;
    }

    /* HORN√ç LI≈†TA */
    .app-header {
      height: 70px;
      background: var(--blue);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      flex-shrink: 0;
    }

    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #fff;
    }

    .logo-img { height: 50px; }

    .hamburger {
      width: 28px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .hamburger span {
      height: 3px;
      border-radius: 999px;
      background: #fff;
    }

    /* HLAVN√ç OBSAH */
    .app-content {
      flex: 1 1 auto;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 14px 14px 10px;
      background: var(--grey-bg);
    }

    /* Z≈ÆSTATEK */
    .card {
      background: #fff;
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
      margin-bottom: 14px;
    }

    .card-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: #e5e5e5;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 14px;
      color: #9e9e9e;
      font-size: 26px;
      cursor: pointer;
    }

    .card-text-main { display: flex; flex-direction: column; gap: 3px; }

    .card-label  { font-size: 18px; color: #b5b5b5; }
    .card-amount { font-size: 22px; color: #ff7a28; font-weight: 600; }

    @keyframes spin-refresh {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    .card-icon i.spinning { animation: spin-refresh 0.45s linear 3; }

    /* PANEL POSLAT PEN√çZE */
    .send-panel {
      margin-top: 18px;
      background: #ffffff;
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }

    .send-title {
      margin: 0 0 4px;
      font-size: 20px;
      font-weight: 600;
    }

    .send-sub {
      margin: 0 0 6px;
      font-size: 13px;
      color: #777;
    }

    .send-subheading {   /* Tuzemsk√° platba ‚Äì NOV√â */
      margin: 0 0px 12px;
      font-size: 19px;
      font-weight: 600;
      color: #444;
    }

    /* TABY */
    .send-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .send-tab {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      padding: 8px 10px;
      font-size: 13px;
      font-weight: 600;
      background: #f5f5f5;
      color: #666;
      cursor: pointer;
      text-align: center;
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    .send-tab.active {
      background: var(--blue);
      border-color: var(--blue);
      color: #fff;
      box-shadow: 0 2px 6px rgba(40,118,222,0.35);
    }

    .field-label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .field-helper {
      font-size: 11px;
      color: #777;
      margin: 2px 0 10px;
    }

    .input-row {
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 6px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: #fafafa;
      margin-bottom: 6px;
    }

    .input-row.focused {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.2);
    }

    .input-prefix {
      font-size: 13px;
      color: #777;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .text-input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 15px;
      outline: none;
    }

    .text-input::placeholder {
      color: #bbb;
    }

    .status-pill {
      margin-top: 8px;
      border-radius: 999px;
      font-size: 12px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-pill.ok {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .status-pill.err {
      background: #ffebee;
      color: #c62828;
    }

    .status-pill i {
      font-size: 13px;
    }

    .btn-inline {
      border-radius: 999px;
      border: none;
      padding: 7px 12px;
      font-size: 12px;
      font-weight: 600;
      background: var(--blue);
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-inline:disabled {
      background: #cfd8e5;
      cursor: default;
    }

    /* ƒå√ÅSTKA */
    .amount-wrapper {
      border-radius: 999px;
      border: 1px solid #ff8a2b;
      padding: 6px 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #fffdf8;
      margin: 10px 0 6px;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .amount-currency {
      font-size: 14px;
      font-weight: 600;
      color: #ff8a2b;
      white-space: nowrap;
    }

    .amount-input {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 18px;
      font-weight: 600;
      outline: none;
      text-align: right;
      padding-right: 10px;
    }

    .amount-input::placeholder {
      color: #ccc;
      font-weight: 400;
    }

    .amount-error {
      font-size: 12px;
      color: #e53935;
      margin-bottom: 4px;
      display: none;
    }

    .amount-error.visible { display: block; }

    /* Extra pole pro bankovn√≠ p≈ôevod ‚Äì v≈ædy viditeln√© */
    .bank-extra {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #f0f0f0;
    }

    .bank-extra-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 10px;
      margin-bottom: 10px;
    }

    /* Nadpis Tuzemsk√° platba + QR tlaƒç√≠tko */
    .bank-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 10px 0 6px;
    }

    .bank-header-title {
      font-size: 15px;
      font-weight: 700;
    }

    /* mal√© tlaƒç√≠tko QR vedle nadpisu */
    .qr-pay-btn {
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 600;
      background: #f5f5f5;
      color: #FF8A00;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .qr-pay-btn i {
      font-size: 14px;
    }

    /* rozlo≈æen√≠ dvou tlaƒç√≠tek v QR popupu */
    .qr-demo-options {
      display: flex;
      gap: 8px;
      margin: 10px 0 6px;
    }

    .qr-demo-options .btn-primary,
    .qr-demo-options .btn-secondary {
      flex: 1;
    }


    .small-input {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ddd;
      padding: 6px 10px;
      font-size: 13px;
      outline: none;
    }

    .small-input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.2);
    }

    .bank-extra-grid .full-width {
      grid-column: 1 / -1;
    }

    /* ≈ò√ÅDEK: k√≥d banky + Vybrat ≈°ablonu ‚Äì NOV√â */
    .bank-code-row {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }

    .bank-code-row .input-row {
      flex: 1;
      margin-bottom: 0;
    }

    .btn-template {
      border-radius: 999px;
      border: 1px solid var(--blue);
      background: #eaf2ff;
      color: var(--blue);
      padding: 8px 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* ODESLAT */
    .btn-main {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 11px 18px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: var(--blue);
      color: #ffffff;
      transition: opacity 0.15s ease, transform 0.05s ease, background 0.15s ease;
    }

    .btn-main:active:not(.btn-disabled) { transform: scale(0.98); }

    .btn-main.btn-disabled {
      background: #cfd8e5;
      cursor: default;
      opacity: 0.85;
    }

    .btn-main.btn-green {         /* zelen√© tlaƒç√≠tko ‚Äì NOV√â */
      background: var(--green);
    }

    .btn-main.btn-grey {          /* ≈°ed√© sekund√°rn√≠ ‚Äì NOV√â */
      background: #e0e0e0;
      color: #444;
    }

    /* Sekce po odesl√°n√≠ / p≈ôi editaci ≈°ablony ‚Äì NOV√â */
    .after-send {
      margin-top: 10px;
    }

    .template-name-label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #444;
    }

    .template-name-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .template-name-input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #ddd;
      padding: 7px 12px;
      font-size: 13px;
      outline: none;
    }

    .template-name-input-row input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.2);
    }

    .save-template-wrapper {
      margin-top: 10px;
      display: flex;
      flex-direction: column;   /* pod sebe */
      align-items: center;      /* na st≈ôed */
      gap: 8px;
    }

    .save-template-wrapper input {
      width: 100%;              /* pole p≈ôes celou ≈°√≠≈ôku panelu */
    }

    .save-template-wrapper .btn-save-template {
      min-width: 60%;           /* aby nebylo moc √∫zk√© */
    }


    /* SPODN√ç LI≈†TA */
    .bottom-bar {
      height: var(--bottom-bar-height);
      background: var(--blue);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0 8px;
      flex-shrink: 0;
    }

    .bottom-link {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
    }

    .bottom-icon-inner {
      width: var(--bottom-icon-box);
      height: var(--bottom-icon-box);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: var(--bottom-icon-font);
    }

    .bottom-icon-inner.plus-icon { background: transparent; }

    .plus-box {
      width: 45px;
      height: 45px;
      border-radius: 10px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .plus-box i {
      color: #2876de;
      font-size: 26px;
    }

    /* MENU ≈ò√ÅDKY ‚Äì P≈ôehled / Transakce / Karty / Notifikace */
    .menu-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .menu-item {
      background: #fff;
      border-radius: 18px;
      padding: 12px 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      display: flex;
      align-items: center;
    }

    .menu-left {
      display: flex;
      align-items: center;
      width: 100%;
      gap: 16px;
    }

    .menu-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 26px;
      flex-shrink: 0;
      position: relative;
    }

    .menu-icon.search { background: #2f7eea; }
    .menu-icon.coins  { background: #2fb2ff; }
    .menu-icon.minus  { background: #32d1a2; }
    .menu-icon.bell   { background: #ff8b39; }

    .menu-label {
      font-size: 18px;
      color: #111;
      margin-left: auto;
      text-align: right;
    }

    /* BADGE + stav pro Notifikace (stejnƒõ jako ve vkladu) */
    .notif-badge {
      position: absolute;
      right: 4px;
      bottom: 4px;
      min-width: 16px;
      height: 16px;
      padding: 0 4px;
      border-radius: 999px;
      background: #ff3b30;
      color: #ffffff;
      font-size: 10px;
      font-weight: 700;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px #ffffff;
    }

    .menu-item.notifications.disabled {
      pointer-events: none;
    }

    .menu-item.notifications.enabled {
      cursor: pointer;
    }

    /* TOAST notifikace */
    .toast {
      position: absolute;
      left: 50%;
      bottom: calc(var(--bottom-bar-height) + 14px);
      transform: translateX(-50%);
      background: #323232;
      color: #fff;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 13px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 50;
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -4px);
    }

    /* MODAL ‚Äì ovƒõ≈ôen√≠ platby (PIN + Face ID) */
    .auth-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
    }

    .auth-backdrop.visible {
      display: flex;
    }

    .auth-modal {
      width: 85%;
      max-width: 360px;
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }

    .auth-title {
      margin: 0 0 4px;
      font-size: 18px;
      font-weight: 600;
    }

    .auth-sub {
      margin: 0 0 14px;
      font-size: 13px;
      color: #666;
    }

    .auth-pin-input {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #ddd;
      padding: 8px 10px;
      font-size: 18px;
      text-align: center;
      letter-spacing: 4px;
      outline: none;
    }

    .auth-pin-input:focus {
      border-color: var(--blue);
      box-shadow: 0 0 0 1px rgba(40,118,222,0.25);
    }

    .auth-error {
      margin-top: 6px;
      font-size: 12px;
      color: #c62828;
      min-height: 16px;
    }

    .auth-actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn-secondary {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: #eceff1;
      color: #333;
    }

    .btn-secondary:active {
      transform: scale(0.98);
    }

    .btn-primary {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      background: var(--blue);
      color: #fff;
    }

    .btn-primary:active {
      transform: scale(0.98);
    }

    .face-step {
      text-align: center;
      padding-top: 6px;
    }

    .face-icon {
      font-size: 42px;
      color: var(--blue);
      margin-bottom: 10px;
    }

    .face-text {
      font-size: 13px;
      color: #555;
      margin-bottom: 12px;
    }

    /* MODAL ‚Äì fotoapar√°t (demo) ‚Äì NOV√â */
    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 55;
    }

    .modal-backdrop.visible {
      display: flex;
    }

    .simple-modal {
      width: 85%;
      max-width: 360px;
      background: #ffffff;
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
      text-align: center;
    }

    .simple-modal-title {
      margin: 0 0 8px;
      font-size: 18px;
      font-weight: 600;
    }

    .simple-modal-text {
      font-size: 13px;
      color: #555;
      margin-bottom: 16px;
    }

    /* MODAL ‚Äì v√Ωbƒõr ≈°ablony ‚Äì NOV√â */
    .template-modal {
      width: 90%;
      max-width: 380px;
      background: #ffffff;
      border-radius: 20px;
      padding: 16px 14px 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35);
    }

    .template-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .template-modal-title {
      font-size: 16px;
      font-weight: 600;
    }

    .template-modal-close {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      color: #555;
    }

    .template-table-head,
    .template-row {
      display: grid;
      grid-template-columns: 2fr 2fr 1fr 1fr auto;
      align-items: center;
      column-gap: 6px;
      font-size: 11px;
    }

    .template-table-head {
      font-weight: 600;
      color: #666;
      margin-bottom: 4px;
    }

    .template-table-body {
      max-height: 210px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .template-row {
      padding: 6px 4px;
      border-radius: 10px;
      cursor: pointer;
    }

    .template-row:nth-child(odd) {
      background: #f7f9fc;
    }

    .template-row:hover {
      background: #eaf2ff;
    }

    .template-actions {
      display: flex;
      gap: 6px;
      justify-content: flex-end;
    }

    .template-icon-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 2px;
      font-size: 13px;
    }

    /* Barevn√© varianty tlaƒç√≠tek */
    .btn-main.btn-orange {
      background: var(--orange);
    }

    .btn-main.btn-blue {
      background: var(--blue);
    }

    /* Sekce po odesl√°n√≠ / ≈°ablony */
    .after-send {
      margin-top: 14px;
    }

    /* Blok "Nov√° ≈°ablona" */
    .template-name-block {
      margin-top: 8px;
    }

    .template-name-label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    /* pilulov√Ω input pro n√°zev ≈°ablony */
    .template-name-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #ff8a2b;
      padding: 8px 14px;
      font-size: 14px;
      outline: none;
      margin-bottom: 8px;
    }

    .template-name-input::placeholder {
      color: #cfd8e5;
    }

    /* modr√© tlaƒç√≠tko pod inputem */
    .template-save-btn {
      width: 100%;
    }



    .template-icon-btn.edit { color: #2876de; }
    .template-icon-btn.delete { color: #e53935; }
  

  </style>
</head>
<body>
  <div class="mobile-frame">
    <div class="app-screen">

      <!-- HORN√ç LI≈†TA -->
      <header class="app-header">
        <div class="logo-wrap">
          <img src="https://rychlapenezenka.cz/images/rp_cerna-bila.png" alt="RP logo" class="logo-img">
        </div>
        <div class="hamburger">
          <span></span><span></span><span></span>
        </div>
      </header>

      <!-- OBSAH -->
      <main class="app-content">

        <!-- Z≈ÆSTATEK -->
        <section class="card">
          <div class="card-icon">
            <i class="fa-solid fa-arrows-rotate"></i>
          </div>
          <div class="card-text-main">
            <div class="card-label">V√°≈° z≈Østatek</div>
            <div class="card-amount" id="balanceAmount">262.12 CZK</div>
          </div>
        </section>

        <!-- Menu polo≈æky (informativn√≠, jako jinde) -->
        <section class="menu-list">
          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon search">
                <i class="fa-solid fa-magnifying-glass"></i>
              </div>
              <div class="menu-label">P≈ôehled</div>
            </div>
          </div>

          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon coins">
                <i class="fa-solid fa-coins"></i>
              </div>
              <div class="menu-label">Transakce</div>
            </div>
          </div>

          <div class="menu-item">
            <div class="menu-left">
              <div class="menu-icon minus">
                <i class="fa-solid fa-credit-card"></i>
              </div>
              <div class="menu-label">Karty</div>
            </div>
          </div>

          <!-- Notifikace s badge + stavem disabled/enabled -->
          <div class="menu-item notifications disabled" id="notificationsRow">
            <div class="menu-left">
              <div class="menu-icon bell">
                <i class="fa-solid fa-bell"></i>
                <span class="notif-badge" id="notifBadge">1</span>
              </div>
              <div class="menu-label">Notifikace</div>
            </div>
          </div>
        </section>


        <!-- PANEL POSLAT PEN√çZE -->
        <section class="send-panel">
          <h1 class="send-title">Poslat pen√≠ze</h1>
          <p class="send-sub">
            Disponibiln√≠ z≈Østatek: <strong id="sendBalance">262,12 CZK</strong>
          </p>

          <!-- TABY ‚Äì Bankovn√≠ p≈ôevod vlevo, default aktivn√≠ -->
          <div class="send-tabs">
            <button class="send-tab active" id="tabBank">Bankovn√≠ p≈ôevod</button>
            <button class="send-tab" id="tabWallet">Mezi penƒõ≈æenkami</button>
          </div>

          <!-- MEZI PENƒö≈ΩENKAMI -->
          <div id="walletSection" style="display:none;">
            <div class="field-label">P≈ô√≠jemce</div>
            <div class="input-row" id="walletRow">
              <span class="input-prefix">@</span>
              <input
                id="walletRecipient"
                class="text-input"
                type="email"
                placeholder="e-mail p≈ô√≠jemce nebo telefon">
              <button id="btnCheckRecipient" class="btn-inline">Zkontrolovat</button>
            </div>
            <div id="walletStatus"></div>

            <div class="field-label" style="margin-top:16px;">ƒå√°stka</div>
            <div class="amount-wrapper">
              <span class="amount-currency">CZK</span>
              <input
                id="walletAmount"
                class="amount-input"
                type="tel"
                inputmode="numeric"
                placeholder="0,00">
            </div>
            <div id="walletAmountError" class="amount-error">
              Nem≈Ø≈æete poslat v√≠c ne≈æ je z≈Østatek Va≈°√≠ penƒõ≈æenky.
            </div>
            <div class="field-helper">
              Maxim√°lnƒõ do v√Ω≈°e z≈Østatku Va≈°√≠ penƒõ≈æenky.
            </div>
          </div>

          <!-- NA BANKOVN√ç √öƒåET -->
          <div id="bankSection">

             <!-- Nadpis + QR tlaƒç√≠tko (demo) -->
            <div class="bank-header">
              <div class="bank-header-title">Tuzemsk√° platba</div>
              <button type="button" id="btnQrDemo" class="qr-pay-btn">
                <i class="fa-solid fa-qrcode"></i>
                QR platba
              </button>
            </div>

            <div class="field-label">ƒå√≠slo √∫ƒçtu</div>
            <div class="input-row">
              <span class="input-prefix">
                <i class="fa-solid fa-building-columns"></i>
              </span>
              <input
                id="bankAccount"
                class="text-input"
                type="text"
                placeholder="1234567890">
              <!-- Fotoapar√°t ‚Äì demo -->
              <button id="btnCamera" class="template-icon-btn edit" type="button" title="Naskenovat ƒç√≠slo √∫ƒçtu (demo)">
                <i class="fa-solid fa-camera"></i>
              </button>
            </div>

            <div class="field-label">K√≥d banky</div>
            <div class="bank-code-row">
              <div class="input-row">
                <span class="input-prefix">k√≥d</span>
                <input
                  id="bankCode"
                  class="text-input"
                  type="text"
                  placeholder="0800">
              </div>
              <button id="btnOpenTemplates" class="btn-template" type="button">
                Vybrat ≈°ablonu
              </button>
            </div>

            <div class="bank-extra" id="bankExtra">
              <div class="bank-extra-grid">
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Jm√©no / n√°zev p≈ô√≠jemce</div>
                  <input id="bankRecipientName" class="small-input" type="text" placeholder="Jm√©no nebo n√°zev spoleƒçnosti">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Variabiln√≠ symbol</div>
                  <input id="vsInput" class="small-input" type="text" placeholder="VS">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Specifick√Ω symbol</div>
                  <input id="ssInput" class="small-input" type="text" placeholder="SS">
                </div>
                <div>
                  <div class="field-label" style="font-size:12px;">Konstantn√≠ symbol</div>
                  <input id="ksInput" class="small-input" type="text" placeholder="KS">
                </div>
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Pozn√°mka pro p≈ô√≠jemce</div>
                  <input id="msgRecipientInput" class="small-input" type="text" placeholder="Zpr√°va na v√Ωpisu p≈ô√≠jemce">
                </div>
                <div class="full-width">
                  <div class="field-label" style="font-size:12px;">Pozn√°mka pro mƒõ</div>
                  <input id="msgMeInput" class="small-input" type="text" placeholder="Intern√≠ pozn√°mka (viditeln√° jen pro v√°s)">
                </div>
              </div>

              <div class="field-label">ƒå√°stka</div>
              <div class="amount-wrapper">
                <span class="amount-currency">CZK</span>
                <input
                  id="bankAmount"
                  class="amount-input"
                  type="tel"
                  inputmode="numeric"
                  placeholder="0,00">
              </div>
              <div id="bankAmountError" class="amount-error">
                Nem≈Ø≈æete poslat v√≠c ne≈æ je z≈Østatek Va≈°√≠ penƒõ≈æenky.
              </div>
            </div>
          </div>

          <!-- SPOLEƒåN√â TLAƒå√çTKO -->
          <button id="btnSend" class="btn-main btn-disabled" disabled>
            Odeslat platbu
          </button>

          <!-- Sekce po odesl√°n√≠ / p≈ôi editaci ≈°ablony ‚Äì NOV√â -->
            <div id="afterSendArea" class="after-send" style="display:none;">
              <!-- ORAN≈ΩOV√â tlaƒç√≠tko naho≈ôe -->
              <button id="btnNewPayment" class="btn-main btn-orange" type="button" style="margin-bottom:8px;">
                Odeslat novou platbu
              </button>

              <!-- Sem budeme z JS vkl√°dat "Vytvo≈ôit ≈°ablonu" / input + Ulo≈æit ≈°ablonu -->
              <div id="templatePrimaryArea"></div>
            </div>


        </section>
      </main>

      <!-- TOAST NOTIFIKACE -->
      <div id="toast" class="toast"></div>

      <!-- MODAL ‚Äì fotoapar√°t (demo) -->
      <div id="cameraBackdrop" class="modal-backdrop">
        <div class="simple-modal">
          <h2 class="simple-modal-title">Naskenovat ƒç√≠slo √∫ƒçtu</h2>
          <p class="simple-modal-text">
            Demo: zde by bylo focen√≠ ƒç√≠sla √∫ƒçtu. Pro uk√°zku m≈Ø≈æete p≈ôedvyplnit testovac√≠ ƒç√≠slo √∫ƒçtu.
          </p>
          <button id="btnCameraFill" class="btn-main btn-green" type="button" style="margin-top:8px;">
            Vyplnit demo ƒç√≠slo √∫ƒçtu
          </button>
          <div style="margin-top:10px;">
            <button id="btnCameraClose" class="btn-secondary" type="button">Zav≈ô√≠t</button>
          </div>
        </div>
      </div>

            <!-- QR PLATBA ‚Äì DEMO MODAL -->
      <div id="qrDemoModal" class="auth-backdrop">
        <div class="auth-modal">
          <h2 class="auth-title">Naƒç√≠st QR platbu (demo)</h2>
          <p class="auth-sub">
            V t√©to uk√°zce QR k√≥d re√°lnƒõ neƒçteme, jen simulujeme postup naƒçten√≠.
          </p>

          <div class="qr-demo-options">
            <button id="btnQrFromGallery" type="button" class="btn-primary">
              Z&nbsp;ulo≈æi≈°tƒõ
            </button>
            <button id="btnQrFromCamera" type="button" class="btn-secondary">
              Kamerou
            </button>
          </div>

          <div id="qrDemoStepCamera" style="display:none; margin-top:10px; font-size:13px; color:#555;">
            <p>Simulace kamery ‚Äì v pln√© verzi by zde byl n√°hled obrazu.</p>
            <button id="btnQrDemoCapture" type="button" class="btn-primary">
              Vyfotit (demo)
            </button>
          </div>

          <div class="auth-actions" style="margin-top:16px;">
            <button id="btnQrDemoClose" type="button" class="btn-secondary">Zav≈ô√≠t</button>
          </div>
        </div>
      </div>



      <!-- MODAL ‚Äì v√Ωbƒõr ≈°ablony -->
      <div id="templateBackdrop" class="modal-backdrop">
        <div class="template-modal">
          <div class="template-modal-header">
            <div class="template-modal-title">Vybrat ≈°ablonu</div>
            <button id="btnTemplateClose" class="template-modal-close" type="button">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>

          <div class="template-table-head">
            <div>N√°zev</div>
            <div>√öƒçet + k√≥d</div>
            <div>VS</div>
            <div>ƒå√°stka</div>
            <div></div>
          </div>
          <div id="templateTableBody" class="template-table-body">
            <!-- ≈ô√°dky se dopln√≠ z JS -->
          </div>
        </div>
      </div>

      <!-- MODAL ‚Äì ovƒõ≈ôen√≠ platby -->
      <div id="authBackdrop" class="auth-backdrop">
        <div class="auth-modal">
          <!-- KROK 1: PIN -->
          <div id="pinStep">
            <h2 class="auth-title">Ovƒõ≈ôen√≠ platby</h2>
            <p class="auth-sub">Zadejte PIN k penƒõ≈æence.</p>
            <input
              id="pinInput"
              class="auth-pin-input"
              type="password"
              inputmode="numeric"
              maxlength="4"
              autocomplete="off"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <div id="pinError" class="auth-error"></div>
            <div class="auth-actions">
              <button id="btnAuthCancel1" class="btn-secondary">Zru≈°it</button>
              <button id="btnPinOk" class="btn-primary">Potvrdit PIN</button>
            </div>
          </div>

          <!-- KROK 2: Face ID -->
          <div id="faceStep" style="display:none;">
            <h2 class="auth-title">Ovƒõ≈ôen√≠ Face ID</h2>
            <div class="face-step">
              <div class="face-icon">
                <i class="fa-regular fa-face-smile"></i>
              </div>
              <p class="face-text">
                Pod√≠vejte se na obrazovku pro ovƒõ≈ôen√≠ Face ID (demo).
              </p>
            </div>
            <div class="auth-actions">
              <button id="btnAuthCancel2" class="btn-secondary">Zru≈°it</button>
              <button id="btnFaceOk" class="btn-primary">Ovƒõ≈ôit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SPODN√ç LI≈†TA -->
      <nav class="bottom-bar">
        <a href="prehled.html" class="bottom-link">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-money-bill-transfer"></i>
          </div>
        </a>

        <a href="prehled.html" class="bottom-link">
          <div class="bottom-icon-inner plus-icon">
            <div class="plus-box">
              <i class="fa-solid fa-plus"></i>
            </div>
          </div>
        </a>

       <a href="posilani_penez.html" class="bottom-link" id="resetPageLink">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-hand-holding-dollar"></i>
          </div>
        </a>

        <a href="sporeni.html" class="bottom-link">
          <div class="bottom-icon-inner">
            <i class="fa-solid fa-piggy-bank"></i>
          </div>
        </a>
      </nav>

    </div>
  </div>

  <script>
    // jednoduch√Ω z≈Østatek
    let currentBalance = 262.12;
    const balanceAmountEl = document.getElementById("balanceAmount");
    const sendBalanceEl   = document.getElementById("sendBalance");

    const resetPageLink = document.getElementById("resetPageLink");

      if (resetPageLink) {
        resetPageLink.addEventListener("click", (e) => {
          e.preventDefault();          // a≈• se nejd≈ô√≠v neprovede defaultn√≠ odkaz
          localStorage.clear();        // sma≈æe v≈°echna ulo≈æen√° data pro tenhle web
          window.location.href = "posilani_penez.html"; // znovu naƒçte str√°nku
        });
      }

    // NOTIFIKACE ‚Äì badge u zvonku (stejn√© jako u vkladu)
    const notifBadge        = document.getElementById("notifBadge");
    const notificationsRow  = document.getElementById("notificationsRow");
    let notifCount = 0;

    // üî• SEM P≈òIDEJ TUTO PROMƒöNNOU
    let isAfterSend = false;   // jsme v re≈æimu "vytvo≈ôit ≈°ablonu"


    function showNewNotification() {
      notifCount += 1;
      if (notifBadge) {
        notifBadge.textContent = notifCount;
        notifBadge.style.display = "flex";
      }
      enableNotificationsRow();
    }

    function enableNotificationsRow() {
      if (!notificationsRow) return;
      notificationsRow.classList.remove("disabled");
      notificationsRow.classList.add("enabled");

      // jen jednou ‚Äì po prvn√≠m odemknut√≠
      notificationsRow.addEventListener("click", () => {
        window.location.href = "notifikace_bankovni_prevod.html";
      }, { once: true });
    }

    // MODAL ‚Äì ovƒõ≈ôen√≠ platby
    const authBackdrop   = document.getElementById("authBackdrop");
    const pinStep        = document.getElementById("pinStep");
    const faceStep       = document.getElementById("faceStep");
    const pinInput       = document.getElementById("pinInput");
    const pinError       = document.getElementById("pinError");
    const btnPinOk       = document.getElementById("btnPinOk");
    const btnFaceOk      = document.getElementById("btnFaceOk");
    const btnAuthCancel1 = document.getElementById("btnAuthCancel1");
    const btnAuthCancel2 = document.getElementById("btnAuthCancel2");

    let pendingTransaction = null; // { mode: 'wallet' | 'bank', amount: number }

    function formatAmountCZK(amount) {
      return amount.toLocaleString("cs-CZ", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function renderBalance() {
      const formatted = formatAmountCZK(currentBalance);
      if (balanceAmountEl) balanceAmountEl.textContent = formatted + " CZK";
    }
    renderBalance(); // horn√≠ z≈Østatek hned po naƒçten√≠

    // toast notifikace
    function showNotification(message) {
      const toast = document.getElementById("toast");
      if (!toast) {
        alert(message);
        return;
      }
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }

    const btnQrDemo        = document.getElementById("btnQrDemo");
    const qrDemoModal      = document.getElementById("qrDemoModal");
    const btnQrDemoClose   = document.getElementById("btnQrDemoClose");
    const btnQrFromGallery = document.getElementById("btnQrFromGallery");
    const btnQrFromCamera  = document.getElementById("btnQrFromCamera");
    const btnQrDemoCapture = document.getElementById("btnQrDemoCapture");
    const qrDemoStepCamera = document.getElementById("qrDemoStepCamera");

    function openQrDemo() {
      if (!qrDemoModal) return;
      qrDemoStepCamera.style.display = "none";
      qrDemoModal.classList.add("visible");
    }

    function closeQrDemo() {
      if (!qrDemoModal) return;
      qrDemoModal.classList.remove("visible");
      qrDemoStepCamera.style.display = "none";
    }

    if (btnQrDemo)       btnQrDemo.addEventListener("click", openQrDemo);
    if (btnQrDemoClose)  btnQrDemoClose.addEventListener("click", closeQrDemo);

    if (btnQrFromGallery) {
      btnQrFromGallery.addEventListener("click", () => {
        showNotification("Demo: otev≈ôel by se v√Ωbƒõr fotky s QR k√≥dem.");
        closeQrDemo();
      });
    }

    if (btnQrFromCamera) {
      btnQrFromCamera.addEventListener("click", () => {
        qrDemoStepCamera.style.display = "block";
      });
    }

    if (btnQrDemoCapture) {
      btnQrDemoCapture.addEventListener("click", () => {
        showNotification("Demo: QR k√≥d naƒçten. V ostr√© verzi by se formul√°≈ô p≈ôedvyplnil.");
        closeQrDemo();
      });
    }



    // MODAL flow
    function openAuthFlow(mode, amount) {
      pendingTransaction = { mode, amount };
      // krok 1 ‚Äì PIN
      pinStep.style.display  = "";
      faceStep.style.display = "none";
      pinInput.value = "";
      pinError.textContent = "";
      authBackdrop.classList.add("visible");
      setTimeout(() => pinInput.focus(), 50);
    }

    function closeAuthFlow() {
      authBackdrop.classList.remove("visible");
      pendingTransaction = null;
    }

    function goToFaceStep() {
      pinStep.style.display  = "none";
      faceStep.style.display = "";
    }

    btnAuthCancel1.addEventListener("click", closeAuthFlow);
    btnAuthCancel2.addEventListener("click", closeAuthFlow);

    // Demo PIN ‚Äì 1234
    btnPinOk.addEventListener("click", () => {
      const val = pinInput.value.trim();
      if (val === "1234") {
        pinError.textContent = "";
        goToFaceStep();
      } else {
        pinError.textContent = "Nespr√°vn√Ω PIN (demo: 1234).";
        pinInput.value = "";
        pinInput.focus();
      }
    });

    pinInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        btnPinOk.click();
      }
    });

    // TABY
    const tabWallet   = document.getElementById("tabWallet");
    const tabBank     = document.getElementById("tabBank");
    const walletSec   = document.getElementById("walletSection");
    const bankSec     = document.getElementById("bankSection");
    const btnSend     = document.getElementById("btnSend");

    function setMode(mode) {
      if (mode === "wallet") {
        tabWallet.classList.add("active");
        tabBank.classList.remove("active");
        walletSec.style.display = "";
        bankSec.style.display   = "none";
      } else {
        tabWallet.classList.remove("active");
        tabBank.classList.add("active");
        walletSec.style.display = "none";
        bankSec.style.display   = "";
      }
      updateSendState();
    }

    tabWallet.addEventListener("click", () => setMode("wallet"));
    tabBank.addEventListener("click",   () => setMode("bank"));

    // MEZI PENƒö≈ΩENKAMI
    const walletRecipient   = document.getElementById("walletRecipient");
    const walletAmount      = document.getElementById("walletAmount");
    const walletStatusBox   = document.getElementById("walletStatus");
    const walletRow         = document.getElementById("walletRow");
    const btnCheck          = document.getElementById("btnCheckRecipient");
    const walletAmountError = document.getElementById("walletAmountError");

    let walletRecipientOk = false;

    btnCheck.addEventListener("click", () => {
      const val = walletRecipient.value.trim();
      walletRecipientOk = false;
      walletStatusBox.innerHTML = "";

      if (!val) return;

      // DEMO logika: pokud obsahuje zavin√°ƒç ‚Üí pova≈æujeme za existuj√≠c√≠ho klienta
      if (val.includes("@")) {
        walletRecipientOk = true;
        walletStatusBox.innerHTML =
          '<div class="status-pill ok"><i class="fa-solid fa-circle-check"></i>' +
          'P≈ô√≠jemce ovƒõ≈ôen ‚Äì demo u≈æivatel</div>';
      } else {
        walletStatusBox.innerHTML =
          '<div class="status-pill err"><i class="fa-solid fa-circle-exclamation"></i>' +
          'P≈ô√≠jemce se nepoda≈ôilo ovƒõ≈ôit.</div>';
      }

      updateSendState();
    });

    // BANKOVN√ç P≈òEVOD
    const bankAccount       = document.getElementById("bankAccount");
    const bankCode          = document.getElementById("bankCode");
    const bankAmount        = document.getElementById("bankAmount");
    const bankAmountError   = document.getElementById("bankAmountError");
    const bankRecipientName = document.getElementById("bankRecipientName");
    const vsInput           = document.getElementById("vsInput");
    const ssInput           = document.getElementById("ssInput");
    const ksInput           = document.getElementById("ksInput");
    const msgRecipientInput = document.getElementById("msgRecipientInput");
    const msgMeInput        = document.getElementById("msgMeInput");

    // FOKUS efekty
    const inputRows = document.querySelectorAll(".input-row");
    inputRows.forEach(row => {
      const input = row.querySelector(".text-input");
      if (!input) return;
      input.addEventListener("focus", () => row.classList.add("focused"));
      input.addEventListener("blur",  () => row.classList.remove("focused"));
    });

    function parseAmount(value) {
      const cleaned = value.replace(/\s/g, "").replace(",", ".");
      const num = parseFloat(cleaned);
      return isNaN(num) ? 0 : num;
    }

    // Disponibiln√≠ z≈Østatek dole ‚Äì podle ƒç√°stky a re≈æimu
    function renderAvailableBalance() {
      if (!sendBalanceEl) return;

      const walletMode = tabWallet.classList.contains("active");
      let available = currentBalance;
      let amt = 0;

      if (walletMode && walletAmount) {
        amt = parseAmount(walletAmount.value.trim());
      } else if (!walletMode && bankAmount) {
        amt = parseAmount(bankAmount.value.trim());
      }

      if (amt > 0) {
        const used = Math.min(amt, currentBalance);
        available = currentBalance - used;
      }

      sendBalanceEl.textContent = formatAmountCZK(available) + " CZK";
    }

    // Sekce po odesl√°n√≠ / ≈°ablony ‚Äì NOV√â
    const afterSendArea       = document.getElementById("afterSendArea");
    const templatePrimaryArea = document.getElementById("templatePrimaryArea");
    const btnNewPayment       = document.getElementById("btnNewPayment");

    btnNewPayment.addEventListener("click", () => {

      // reset ≈°ablonov√©ho re≈æimu
      isAfterSend = false;

      // schovat sekci po odesl√°n√≠
      afterSendArea.style.display = "none";

      // znovu zobrazit tlaƒç√≠tko Pokraƒçovat / Odeslat
      btnSend.style.display = "";

      // smazat template UI
      templatePrimaryArea.innerHTML = "";

      // reset pol√≠ (dle pot≈ôeby)
      bankAmount.value = "";
      // p≈ô√≠padnƒõ v≈°echny ostatn√≠ bankovn√≠ inputy, pokud chce≈° full reset:
      // bankAccount.value = "";
      // bankCode.value = "";
      // bankRecipientName.value = "";
      // vsInput.value = "";
      // ssInput.value = "";
      // ksInput.value = "";
      // msgRecipientInput.value = "";
      // msgMeInput.value = "";

      // p≈ôepoƒç√≠t√°n√≠ validace
      updateSendState();
    });

    let editingTemplateId = null;   // null = nov√° ≈°ablona, jinak p≈ôepisujeme existuj√≠c√≠

    function showCreateTemplatePrompt() {
      // uk√°≈æeme sekci
      afterSendArea.style.display = "block";

      // ORAN≈ΩOV√â tlaƒç√≠tko naho≈ôe
      btnNewPayment.textContent = "Odeslat novou platbu";
      btnNewPayment.classList.remove("btn-grey");
      btnNewPayment.classList.add("btn-orange");

      // dole jen jedno modr√© tlaƒç√≠tko "Vytvo≈ôit ≈°ablonu"
      templatePrimaryArea.innerHTML = `
        <button id="btnCreateTemplate" class="btn-main btn-blue" type="button">
          Vytvo≈ôit ≈°ablonu
        </button>
      `;

      const btnCreateTemplate = document.getElementById("btnCreateTemplate");
      if (btnCreateTemplate) {
        btnCreateTemplate.addEventListener("click", () => {
          showTemplateNameInput();
        });
      }
    }

    function showTemplateNameInput(existingName) {
      // v≈ædy uk√°≈æeme sekci
      afterSendArea.style.display = "block";

      // oran≈æov√© "Odeslat novou platbu" naho≈ôe z≈Øst√°v√°
      btnNewPayment.textContent = "Odeslat novou platbu";
      btnNewPayment.classList.remove("btn-grey");
      btnNewPayment.classList.add("btn-orange");

      const safeName = existingName
        ? existingName.replace(/"/g, '&quot;')
        : "";

      // blok: label -> input -> modr√© tlaƒç√≠tko p≈ôes celou ≈°√≠≈ôku
      templatePrimaryArea.innerHTML = `
        <div class="template-name-block">
          <div class="template-name-label">
            ${existingName ? "Upravit ≈°ablonu" : "Nov√° ≈°ablona"}
          </div>
          <input
            id="templateNameInput"
            type="text"
            class="template-name-input"
            placeholder="vlo≈æ n√°zev ≈°ablony"
            value="${safeName}"
          >
          <button
            id="btnSaveTemplate"
            class="btn-main btn-blue template-save-btn"
            type="button"
          >
            Ulo≈æit ≈°ablonu
          </button>
        </div>
      `;

      const nameInput = document.getElementById("templateNameInput");
      const btnSaveTemplate = document.getElementById("btnSaveTemplate");

      if (btnSaveTemplate) {
        btnSaveTemplate.addEventListener("click", () => {
          const name = nameInput.value.trim();
          if (!name) {
            alert("Zadejte n√°zev ≈°ablony.");
            return;
          }
          saveTemplateFromForm(name); // tuhle funkci u≈æ v k√≥du m√°≈°
        });
      }

      if (nameInput) {
        nameInput.focus();
        nameInput.select();
      }
    }


    btnNewPayment.addEventListener("click", () => {
      resetBankForm();
      clearTemplateUI();
      updateSendState();
    });

    function resetBankForm() {
      bankAccount.value       = "";
      bankCode.value          = "";
      bankRecipientName.value = "";
      vsInput.value           = "";
      ssInput.value           = "";
      ksInput.value           = "";
      msgRecipientInput.value = "";
      msgMeInput.value        = "";
      bankAmount.value        = "";
    }

    // ≈†ABLONY ‚Äì data + localStorage ‚Äì NOV√â
    const TEMPLATE_STORAGE_KEY = "rpBankTemplates";

    const DEFAULT_TEMPLATES = [
      {
        id: "tmpl1",
        name: "N√°jem",
        account: "1234567890",
        bankCode: "0800",
        recipientName: "Pronaj√≠matel s.r.o.",
        vs: "20240001",
        ss: "",
        ks: "",
        msgRecipient: "N√°jemn√©",
        msgMe: "N√°jem byt",
        amount: 12000
      },
      {
        id: "tmpl2",
        name: "Mobiln√≠ tarif",
        account: "9876543210",
        bankCode: "0100",
        recipientName: "Moje telefonn√≠ spoleƒçnost a.s.",
        vs: "555555",
        ss: "",
        ks: "",
        msgRecipient: "Faktura za slu≈æby",
        msgMe: "Telefon",
        amount: 799
      }
    ];

    let templates = [];

    function loadTemplates() {
      try {
        const stored = localStorage.getItem(TEMPLATE_STORAGE_KEY);
        if (stored) {
          templates = JSON.parse(stored);
        } else {
          templates = DEFAULT_TEMPLATES.slice();
          saveTemplates();
        }
      } catch (e) {
        templates = DEFAULT_TEMPLATES.slice();
      }
    }

    function saveTemplates() {
      try {
        localStorage.setItem(TEMPLATE_STORAGE_KEY, JSON.stringify(templates));
      } catch (e) {
        // ignore
      }
    }

    function clearTemplateUI() {
      editingTemplateId = null;
      afterSendArea.style.display = "none";
      templatePrimaryArea.innerHTML = "";

      // vr√°t√≠me vzhled tlaƒç√≠tka
      btnNewPayment.classList.remove("btn-orange");
      btnNewPayment.classList.add("btn-grey");
      btnNewPayment.textContent = "Odeslat novou platbu";

      btnSend.style.display = ""; // uk√°zat hlavn√≠ tlaƒç√≠tko zpƒõt (pro dal≈°√≠ platbu)
    }


    function renderTemplateTable() {
      const body = document.getElementById("templateTableBody");
      if (!body) return;
      body.innerHTML = "";
      if (!templates.length) {
        const div = document.createElement("div");
        div.style.fontSize = "12px";
        div.style.color = "#777";
        div.style.padding = "8px 4px";
        div.textContent = "Nem√°te zat√≠m ≈æ√°dn√© ≈°ablony.";
        body.appendChild(div);
        return;
      }

      templates.forEach(t => {
        const row = document.createElement("div");
        row.className = "template-row";
        row.dataset.id = t.id;

        const colName = document.createElement("div");
        colName.textContent = t.name || "";

        const colAcc = document.createElement("div");
        colAcc.textContent = (t.account || "") + (t.bankCode ? " / " + t.bankCode : "");

        const colVs = document.createElement("div");
        colVs.textContent = t.vs || "";

        const colAmt = document.createElement("div");
        colAmt.textContent = t.amount != null ? formatAmountCZK(Number(t.amount)) + " Kƒç" : "";

        const colActions = document.createElement("div");
        colActions.className = "template-actions";

        const btnEdit = document.createElement("button");
        btnEdit.className = "template-icon-btn edit";
        btnEdit.type = "button";
        btnEdit.innerHTML = '<i class="fa-solid fa-pen"></i>';

        const btnDelete = document.createElement("button");
        btnDelete.className = "template-icon-btn delete";
        btnDelete.type = "button";
        btnDelete.innerHTML = '<i class="fa-solid fa-trash"></i>';

        colActions.appendChild(btnEdit);
        colActions.appendChild(btnDelete);

        row.appendChild(colName);
        row.appendChild(colAcc);
        row.appendChild(colVs);
        row.appendChild(colAmt);
        row.appendChild(colActions);

        // klik na ≈ô√°dek ‚Äì naƒçten√≠ ≈°ablony
        row.addEventListener("click", () => {
          const tmpl = templates.find(tt => tt.id === t.id);
          if (!tmpl) return;
          fillFormFromTemplate(tmpl);
          closeTemplateModal();
        });

        // edit ‚Äì p≈ôepsat st√°vaj√≠c√≠
        btnEdit.addEventListener("click", (e) => {
          e.stopPropagation();
          const tmpl = templates.find(tt => tt.id === t.id);
          if (!tmpl) return;
          fillFormFromTemplate(tmpl);
          closeTemplateModal();
          editingTemplateId = tmpl.id;
          btnSend.style.display = "none"; // upravujeme ≈°ablonu, neodes√≠l√°me
          showTemplateNameInput(tmpl.name);
        });

        // delete ‚Äì odstranit ≈°ablonu
        btnDelete.addEventListener("click", (e) => {
          e.stopPropagation();
          const index = templates.findIndex(tt => tt.id === t.id);
          if (index !== -1) {
            templates.splice(index, 1);
            saveTemplates();
            renderTemplateTable();
          }
        });

        body.appendChild(row);
      });
    }

    function fillFormFromTemplate(t) {
      bankAccount.value       = t.account || "";
      bankCode.value          = t.bankCode || "";
      bankRecipientName.value = t.recipientName || "";
      vsInput.value           = t.vs || "";
      ssInput.value           = t.ss || "";
      ksInput.value           = t.ks || "";
      msgRecipientInput.value = t.msgRecipient || "";
      msgMeInput.value        = t.msgMe || "";
      bankAmount.value        = t.amount != null ? String(t.amount).replace(".", ",") : "";
      updateSendState();
    }

    function saveTemplateFromForm(name) {
      const tmplData = {
        id: editingTemplateId || ("tmpl_" + Date.now()),
        name,
        account: bankAccount.value.trim(),
        bankCode: bankCode.value.trim(),
        recipientName: bankRecipientName.value.trim(),
        vs: vsInput.value.trim(),
        ss: ssInput.value.trim(),
        ks: ksInput.value.trim(),
        msgRecipient: msgRecipientInput.value.trim(),
        msgMe: msgMeInput.value.trim(),
        amount: parseAmount(bankAmount.value.trim())
      };

      if (editingTemplateId) {
        const idx = templates.findIndex(t => t.id === editingTemplateId);
        if (idx !== -1) {
          templates[idx] = tmplData;
        } else {
          templates.push(tmplData);
        }
      } else {
        templates.push(tmplData);
      }

      saveTemplates();
      renderTemplateTable();
      showNotification("≈†ablona byla ulo≈æena.");
      resetBankForm();
      clearTemplateUI();
      updateSendState();
    }

    // MODAL ‚Äì template v√Ωbƒõr
    const templateBackdrop   = document.getElementById("templateBackdrop");
    const btnOpenTemplates   = document.getElementById("btnOpenTemplates");
    const btnTemplateClose   = document.getElementById("btnTemplateClose");

    function openTemplateModal() {
      templateBackdrop.classList.add("visible");
      renderTemplateTable();
    }

    function closeTemplateModal() {
      templateBackdrop.classList.remove("visible");
    }

    btnOpenTemplates.addEventListener("click", openTemplateModal);
    btnTemplateClose.addEventListener("click", closeTemplateModal);
    templateBackdrop.addEventListener("click", (e) => {
      if (e.target === templateBackdrop) {
        closeTemplateModal();
      }
    });

    // Fotoapar√°t ‚Äì demo modal
    const cameraBackdrop = document.getElementById("cameraBackdrop");
    const btnCamera      = document.getElementById("btnCamera");
    const btnCameraClose = document.getElementById("btnCameraClose");
    const btnCameraFill  = document.getElementById("btnCameraFill");

    function openCameraModal() {
      cameraBackdrop.classList.add("visible");
    }

    function closeCameraModal() {
      cameraBackdrop.classList.remove("visible");
    }

    btnCamera.addEventListener("click", openCameraModal);
    btnCameraClose.addEventListener("click", closeCameraModal);
    cameraBackdrop.addEventListener("click", (e) => {
      if (e.target === cameraBackdrop) {
        closeCameraModal();
      }
    });

    btnCameraFill.addEventListener("click", () => {
      bankAccount.value = "1112223339";
      bankCode.value = "0800";
      updateSendState();
      closeCameraModal();
    });

    // LOGIKA enable/disable tlaƒç√≠tka
    function updateSendState() {
      const walletMode = tabWallet.classList.contains("active");
      let enabled = false;

      if (walletMode) {
        const amt = parseAmount(walletAmount.value.trim());

        if (walletAmountError) {
          if (!isAfterSend) {
            // bƒõ≈æn√° validace
            walletAmountError.classList.toggle(
              "visible",
              amt > currentBalance && amt > 0
            );
          } else {
            // v re≈æimu ≈°ablony nechci ƒçervenou hl√°≈°ku
            walletAmountError.classList.remove("visible");
          }
        }

        enabled = walletRecipientOk && amt > 0 && amt <= currentBalance;

      } else {
        const amt             = parseAmount(bankAmount.value.trim());
        const hasAccount      = bankAccount.value.trim().length > 0;
        const hasBankCode     = bankCode.value.trim().length > 0;
        const hasRecipientName = bankRecipientName.value.trim().length > 1;

        if (bankAmountError) {
          if (!isAfterSend) {
            bankAmountError.classList.toggle(
              "visible",
              amt > currentBalance && amt > 0
            );
          } else {
            bankAmountError.classList.remove("visible");
          }
        }

        enabled =
          hasAccount &&
          hasBankCode &&
          hasRecipientName &&
          amt > 0 &&
          amt <= currentBalance;
      }

      // p≈ôepoƒçet disponibiln√≠ho z≈Østatku p≈ôi ka≈æd√© zmƒõnƒõ
      renderAvailableBalance();

      if (enabled) {
        btnSend.disabled = false;
        btnSend.classList.remove("btn-disabled");
      } else {
        btnSend.disabled = true;
        btnSend.classList.add("btn-disabled");
      }
    }


    walletRecipient.addEventListener("input", () => {
      walletRecipientOk = false;
      walletStatusBox.innerHTML = "";
      updateSendState();
    });
    walletAmount.addEventListener("input", updateSendState);
    bankAccount.addEventListener("input", updateSendState);
    bankCode.addEventListener("input", updateSendState);
    bankAmount.addEventListener("input", updateSendState);
    bankRecipientName.addEventListener("input", updateSendState);

    // dokonƒçen√≠ transakce po Face ID
    function performTransaction(mode, amt) {
      if (amt <= 0 || amt > currentBalance) {
        updateSendState();
        return;
      }

      currentBalance = Math.max(0, currentBalance - amt);
      renderBalance();
      renderAvailableBalance();

      if (mode === "wallet") {
        showNotification("Demo: odesl√°no " + formatAmountCZK(amt) + " CZK jin√© penƒõ≈æence RP.");
      } else {
        showNotification("Demo: odesl√°no " + formatAmountCZK(amt) + " CZK na bankovn√≠ √∫ƒçet.");
      }

      // vyƒçi≈°tƒõn√≠ pol√≠
      if (mode === "wallet") {
        walletAmount.value = "";
        walletRecipientOk = false;
        walletStatusBox.innerHTML = "";
      } else {
        // neresetujeme hned ‚Äì nech√°me data pro p≈ô√≠padnou ≈°ablonu
      }

      // vytvo≈ôit novou notifikaci (badge + odemknout ≈ô√°dek)
      showNewNotification();



      // U bankovn√≠ platby zobraz√≠me sekci pro ≈°ablony
      if (mode === "bank") {
        isAfterSend = true;

        if (walletAmountError) walletAmountError.classList.remove("visible");
        if (bankAmountError)   bankAmountError.classList.remove("visible");

      
        btnSend.style.display = "none"; // u≈æ nepos√≠l√°me znovu
        editingTemplateId = null;
        showCreateTemplatePrompt();
      } else {
        clearTemplateUI();
      }

      updateSendState();
    }

    btnFaceOk.addEventListener("click", () => {
      if (!pendingTransaction) {
        closeAuthFlow();
        return;
      }
      // po "Face ID" dokonƒç√≠me transakci
      performTransaction(pendingTransaction.mode, pendingTransaction.amount);
      closeAuthFlow();
    });

    // Klik na Odeslat platbu ‚Äì spust√≠ ovƒõ≈ôovac√≠ flow (PIN + Face ID)
    btnSend.addEventListener("click", () => {
      if (btnSend.disabled) return;

      const walletMode = tabWallet.classList.contains("active");
      let amt = 0;

      if (walletMode) {
        amt = parseAmount(walletAmount.value.trim());
      } else {
        amt = parseAmount(bankAmount.value.trim());
      }

      if (amt <= 0 || amt > currentBalance) {
        updateSendState();
        return;
      }

      openAuthFlow(walletMode ? "wallet" : "bank", amt);
    });

    // animace ≈°ipky
    const refreshWrapper = document.querySelector(".card-icon");
    const refreshIcon    = refreshWrapper ? refreshWrapper.querySelector("i") : null;

    if (refreshWrapper && refreshIcon) {
      refreshWrapper.addEventListener("click", () => {
        if (refreshIcon.classList.contains("spinning")) return;
        refreshIcon.classList.add("spinning");
        refreshIcon.addEventListener(
          "animationend",
          () => refreshIcon.classList.remove("spinning"),
          { once: true }
        );
      });
    }

    // inicializace
    loadTemplates();
    setMode("bank");           // default: Bankovn√≠ p≈ôevod vlevo
    renderAvailableBalance();
  </script>
</body>
</html>
