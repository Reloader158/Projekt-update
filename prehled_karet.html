<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Přehled karet – verze 1</title>
  <style>
    :root{
      --blue:#3d78d8;
      --blue-dark:#2f66c4;
      --sidebar-w:260px;
      --sidebar-w-collapsed:66px;
      --bg:#f2f4f7;
      --card:#ffffff;
      --line:#e6e9ef;
      --muted:#6b7280;
      --link:#1e66ff;
      --btn-blue:#2f66c4;
      --btn-red:#ef4444;
      --btn-purple:#7b1fa2;
      --shadow:0 1px 2px rgba(0,0,0,.08);
      --menu-gap: 6px;

      /* šířky sloupců (aby filtry seděly nad sloupce) */
      --c-user: 170px;
      --c-vs: 130px;
      --c-holder: 170px;
      --c-issued: 200px;
      --c-card: 170px;
      --c-status: 200px;
      --c-pay: 140px;
      --c-rej: 200px;
      --c-lastcmd: 180px;
      --c-edit: 70px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color:#111827;
    }

    /* Top bar */
    .topbar{
      position:fixed;
      top:0; left:0; right:0;
      height:56px;
      background: var(--blue);
      display:flex;
      align-items:center;
      padding:0 16px;
      z-index:50;
      box-shadow: var(--shadow);
    }
    .topbar .brand{
      display:flex;
      align-items:center;
      gap:10px;
      color:#fff;
      font-weight:700;
      letter-spacing:.2px;
    }
    .deploy-pill{
      display:inline-flex;
      align-items:stretch;
      border-radius:4px;
      overflow:hidden;
      box-shadow: 0 1px 0 rgba(0,0,0,.12);
      font-size:12px;
      font-weight:800;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    .deploy-pill .left{
      background:#2f343b;
      color:#fff;
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
    }
    .deploy-pill .left .fb{
      width:16px; height:16px;
      border-radius:3px;
      background:#111;
      display:grid;
      place-items:center;
      font-size:12px;
      line-height:1;
    }
    .deploy-pill .right{
      background:#11a372;
      color:#fff;
      display:flex;
      align-items:center;
      padding:6px 10px;
      font-weight:900;
    }
    .topbar .spacer{ flex:1; }
    .topbar .userbtn{
      background:#f59e0b;
      color:#fff;
      border:none;
      border-radius:4px;
      padding:7px 10px;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
    }

    /* Sidebar */
    .sidebar{
      position:fixed;
      top:56px; left:0; bottom:0;
      width:var(--sidebar-w);
      background:#fff;
      border-right:1px solid var(--line);
      padding:10px 10px 14px;
      overflow:auto;
      transition: width .18s ease;
    }
    body.sidebar-collapsed .sidebar{ width: var(--sidebar-w-collapsed); }

    .side-top{
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 6px 10px;
      border-bottom:1px solid #f0f2f6;
      margin-bottom:10px;
    }
    .hamburger{
      width:34px; height:28px;
      border:1px solid #d7dce6;
      border-radius:4px;
      background:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
    }
    .hamburger:hover{ background:#f8fafc; }
    .hamburger .bars{
      width:16px; height:12px; position:relative;
    }
    .hamburger .bars::before,
    .hamburger .bars::after,
    .hamburger .bars span{
      content:"";
      position:absolute; left:0; right:0;
      height:2px; background:#6b7280; border-radius:2px;
    }
    .hamburger .bars::before{ top:0; }
    .hamburger .bars span{ top:5px; }
    .hamburger .bars::after{ bottom:0; }

    .side-title{
      font-size:12px;
      color:#6b7280;
      font-weight:800;
      letter-spacing:.02em;
      white-space:nowrap;
    }
    body.sidebar-collapsed .side-title{ display:none; }

    .menu-section{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
      padding:12px 10px 6px;
    }
    .menu a{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border-radius:6px;
      text-decoration:none;
      color:#374151;
      font-size:13px;
      cursor:default;
      margin-bottom: var(--menu-gap);
    }
    .menu a:hover{ background:#f8fafc; }

    .mi{ width:18px; height:18px; color:#9ca3af; flex:0 0 auto; }
    .mi svg{ width:18px; height:18px; display:block; fill: currentColor; }
    .menu .txt{ white-space:nowrap; }
    body.sidebar-collapsed .menu .txt{ display:none; }

    /* Main */
    .main{
      margin-left:var(--sidebar-w);
      padding:18px 16px;
      padding-top: 56px + 18px;
      transition: margin-left .18s ease;
    }
    body.sidebar-collapsed .main{ margin-left: var(--sidebar-w-collapsed); }

    .main-inner{
      padding-top: 18px;
      margin-top:56px;
      max-width:3440px;
    }

    /* Card */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:8px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-header{
      background: var(--blue);
      color:#fff;
      padding:12px 12px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    /* (2) Ikona karty */
    .card-icon{
      width:24px; height:24px;
      border-radius:4px;
      background: rgba(255,255,255,.18);
      display:grid;
      place-items:center;
      user-select:none;
    }
    .card-icon svg{ width:18px; height:18px; fill:#fff; display:block; }
    .card-header h2{
      margin:0;
      font-size:18px;
      font-weight:900;
    }
    .card-header .hdr-spacer{ flex:1; }
    .tiny-btn{
      border:1px solid rgba(255,255,255,.65);
      background: rgba(0,0,0,.08);
      color:#fff;
      font-weight:900;
      font-size:12px;
      padding:6px 10px;
      border-radius:4px;
      cursor:pointer;
    }

    .card-body{ padding:14px 14px 10px; }

    /* Actions row */
    .actions{
      display:flex;
      flex-direction:column;
      align-items:flex-end;   /* vše vpravo */
      gap:8px;
      margin-bottom:10px;
    }
    .actions-top,
    .actions-bottom{
      display:flex;
      justify-content:flex-end;
      gap:10px;
    }

    .btn{
      border:none;
      border-radius:4px;
      padding:7px 10px;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
      box-shadow: 0 1px 0 rgba(0,0,0,.06);
    }
    .btn-purple{ background: var(--btn-purple); color:#fff; padding:8px 14px; }
    .btn-blue{ background: var(--btn-blue); color:#fff; }
    .btn-red{ background: var(--btn-red); color:#fff; }
    .btn:active{ transform: translateY(1px); }

    .meta-inline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      color:var(--muted);
      font-size:12px;
      margin: 6px 0 8px;
    }
    .meta-inline b{ color:#111827; }

    /* Table area */
    .table-shell{
      border-top:1px solid var(--line);
      margin-top:6px;
      height: calc(100vh - 56px - 18px - 18px - 120px);
      min-height: 320px;
      overflow:auto;
      background:#fff;
    }

    table{
      border-collapse:separate;
      border-spacing:0;
      width:100%;
      min-width: calc(
        var(--c-user) + var(--c-vs) + var(--c-holder) + var(--c-issued) + var(--c-card) +
        var(--c-status) + var(--c-pay) + var(--c-rej) + var(--c-lastcmd) + var(--c-edit)
      );
      font-size:12px;
      table-layout: fixed;
    }
    col.user{ width: var(--c-user); }
    col.vs{ width: var(--c-vs); }
    col.holder{ width: var(--c-holder); }
    col.issued{ width: var(--c-issued); }
    col.card{ width: var(--c-card); }
    col.status{ width: var(--c-status); }
    col.pay{ width: var(--c-pay); }
    col.rej{ width: var(--c-rej); }
    col.lastcmd{ width: var(--c-lastcmd); }
    col.edit{ width: var(--c-edit); }

    thead th{
      background:#fff;
      z-index:2;
      text-align:left;
      padding:8px 8px;
      border-bottom:1px solid var(--line);
      font-weight:900;
      color:#111827;
      white-space:nowrap;
    }
    thead tr.filters-row th{
      position:sticky;
      top:0;
      background:#fff;
      z-index:20;
      padding:6px 8px 8px;
      border-bottom:1px solid #eef1f6;
      height:46px;              /* FIX výška */
      vertical-align:middle;
    }

    thead tr.labels-row th{
      position:sticky;
      top:46px;                 /* MUSÍ sedět s height výš */
      background:#fff;
      z-index:10;
      padding:8px 8px;
      border-bottom:1px solid var(--line);
    }


    /* DŮLEŽITÉ: aby inputy šly vždy kliknout */
    thead tr.filters-row th{
      position: sticky;
    }
    thead tr.filters-row th,
    thead tr.filters-row th *{
      pointer-events: auto;
    }
    thead tr.filters-row th{
      isolation: isolate;       /* brání divným překryvům */
    }

    .finput, .fselect, .fdate{
      width:100%;
      border:1px solid #cfd6e1;
      border-radius:2px;
      height:26px;
      padding:0 8px;
      font-size:12px;
      background:#fff;
    }
    /* date input klikatelnost + vizuál */
    .fdate{
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    .date-2{ display:grid; grid-template-columns: 1fr 1fr; gap:6px; }

    tbody td{
      padding:8px 8px;
      border-bottom:1px solid #eef1f6;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    tbody tr:nth-child(odd){ background:#c0bebe; 
    }

    /* hover efekt na řádek tabulky */
    tbody tr{
      transition: background-color 0.12s ease;
    }

    tbody tr:hover{
      background-color:#a4a2a2; /* lehce tmavší než základ */
    }

    a.link{
      color:var(--link);
      text-decoration:underline;
      cursor:pointer;
    }
    .edit-btn{
      width:28px; height:22px;
      border:none;
      background:#2f66c4;
      color:#fff;
      border-radius:3px;
      font-weight:900;
      cursor:pointer;
    }
    .right{ text-align:right; }

    /* (4) šipky pro řazení v hlavičce */
    .th-flex{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .sort-arrows{
      display:inline-flex;
      gap:4px;
      align-items:center;
      flex:0 0 auto;
    }
    .sbtn{
      width:22px; height:22px;
      border:1px solid #b8c3d6;
      border-radius:4px;
      background:#e9f0ff;          /* světle modrá */
      cursor:pointer;
      display:grid;
      place-items:center;
      color:#1f4fa3;               /* modrá šipka */
      line-height:1;
      font-weight:900;
      user-select:none;
      transition: background .12s ease, border-color .12s ease, color .12s ease;
    }
    .sbtn:hover{
      background:#dbe8ff;
      border-color:#9fb3d7;
    }
    .sbtn.active{
      background:#ffe3e3;          /* světle červená */
      border-color:#ff6b6b;
      color:#c81e1e;               /* červená šipka */
      box-shadow: inset 0 0 0 1px rgba(200,30,30,.15);
    }


    @media (max-width: 3440px){
      .table-shell{ height: calc(100vh - 56px - 18px - 18px - 140px); }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="brand">
      <span style="font-size:22px;">RP</span>

      <div class="deploy-pill" title="rychlapenezenka.cz">
        <div class="left">
          <span class="fb">f</span>
          <span>rychlapenezenka.cz</span>
        </div>
        <div class="right">deployed (N/A) 5 days ago</div>
      </div>
    </div>
    <div class="spacer"></div>
    <button class="userbtn">● Patrik Denemark ▾</button>
  </div>

  <aside class="sidebar">
    <!-- (1) Hamburger v sidebaru hned nahoře -->
    <div class="side-top">
      <button class="hamburger" id="hamburger" title="Menu">
        <div class="bars"><span></span></div>
      </button>
      <div class="side-title">Menu</div>
    </div>

    <div class="menu">
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 3 3 10v11h6v-7h6v7h6V10z"/></svg></span><span class="txt">Přehled stavu</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 3-1.34 3-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3ZM8 11c1.66 0 3-1.34 3-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3Zm0 2c-2.67 0-8 1.34-8 4v2h10v-2c0-1.14.4-2.1 1.05-2.9C10.2 13.4 9.1 13 8 13Zm8 0c-1.1 0-2.2.4-3.05 1.1.65.8 1.05 1.76 1.05 2.9v2h10v-2c0-2.66-5.33-4-8-4Z"/></svg></span><span class="txt">Zákaznické účty</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M3 4h18v4H3V4Zm0 6h18v10H3V10Zm4 3v2h6v-2H7Z"/></svg></span><span class="txt">Všechny transakce</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4Zm0 11h7c-.53 3.79-3.28 7.2-7 8.48V12H5V6.3l7-3.11V12Z"/></svg></span><span class="txt">Všechny poplatky</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M20 6H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2Zm0 10H4V8h16v8Zm-2-6H6v2h12v-2Z"/></svg></span><span class="txt">Přehled karet</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2Zm6-6V11c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 0 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2Z"/></svg></span><span class="txt">Notifikace</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 2c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4Zm-7 10v2h14v-2H5Z"/></svg></span><span class="txt">Bonusy a srážky</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M19 4H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2Zm0 14H5V8h14v10Zm-2-8H7v2h10v-2Z"/></svg></span><span class="txt">Provozní odstávky</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M3 3h2v18H3V3Zm16 8h2v10h-2V11ZM11 7h2v14h-2V7Zm-4 6h2v8H7v-8Zm8-10h2v18h-2V3Z"/></svg></span><span class="txt">Statistiky a uzávěrky</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M3 17h18v2H3v-2Zm0-5h18v2H3v-2Zm0-5h18v2H3V7Z"/></svg></span><span class="txt">Logy</span></a>

      <div class="menu-section">Nastavení</div>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8Zm10 4a8.1 8.1 0 0 0-.14-1.5l2.02-1.57-2-3.46-2.45 1a8.2 8.2 0 0 0-2.6-1.5l-.37-2.6H9.54l-.37 2.6a8.2 8.2 0 0 0-2.6 1.5l-2.45-1-2 3.46L2.14 10.5A8.1 8.1 0 0 0 2 12c0 .5.05 1 .14 1.5l-2.02 1.57 2 3.46 2.45-1a8.2 8.2 0 0 0 2.6 1.5l.37 2.6h4.92l.37-2.6a8.2 8.2 0 0 0 2.6-1.5l2.45 1 2-3.46-2.02-1.57c.09-.5.14-1 .14-1.5Z"/></svg></span><span class="txt">Sledování činnosti práce</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2Zm0 4-8 5-8-5V6l8 5 8-5v2Z"/></svg></span><span class="txt">Odesílání e-mailů</span></a>
      <a><span class="mi"><svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm1 11H7v-2h6V5h2v8Z"/></svg></span><span class="txt">Status RP</span></a>
    </div>
  </aside>

  <main class="main">
    <div class="main-inner">
      <section class="card">
        <div class="card-header">
          <div class="card-icon" aria-hidden="true" title="Karta">
            <svg viewBox="0 0 24 24">
              <path d="M20 6H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2Zm0 10H4V12h16v4Zm0-6H4V8h16v2Z"/>
            </svg>
          </div>
          <h2>Přehled karet</h2>
          <div class="hdr-spacer"></div>
          <button class="tiny-btn">.pdf</button>
          <button class="tiny-btn">.csv</button>
        </div>

        <div class="card-body">
          <div class="actions">
            <div class="actions-top">
              <button class="btn btn-purple">Zrušit všechny mé rezervace</button>
            </div>
            <div class="actions-bottom">
              <button id="btnFilter" class="btn btn-blue">Filtr</button>
              <button id="btnReset" class="btn btn-red">Reset</button>
            </div>
          </div>

          

          <div class="table-shell" id="tableShell">
            <table>
              <colgroup>
                <col class="user"><col class="vs"><col class="holder"><col class="issued"><col class="card">
                <col class="status"><col class="pay"><col class="rej"><col class="lastcmd"><col class="edit">
              </colgroup>

              <thead>
                <tr class="filters-row">
                  <th><input id="fUserName" class="finput" type="text" placeholder="Jméno uživatele"></th>
                  <th><input id="fVS" class="finput" type="text" placeholder="VS"></th>
                  <th><input id="fHolder" class="finput" type="text" placeholder="Držitel"></th>
                  <th>
                    <div class="date-2">
                      <input id="fIssuedFrom" class="fdate" type="date" title="Datum vydání – od">
                      <input id="fIssuedTo" class="fdate" type="date" title="Datum vydání – do">
                    </div>
                  </th>
                  <th><input id="fCard" class="finput" type="text" placeholder="Číslo karty"></th>
                  <th>
                    <select id="fStatus" class="fselect">
                      <option value="">Všechny</option>
                      <option>Vydaná bez nastavení</option>
                      <option>Vydaná</option>
                      <option>Blokovaná provozovatelem</option>
                      <option>Blokovaná uživatelem</option>
                      <option>Vydaná ve výpovědi</option>
                      <option>Zrušená uživatelem</option>
                      <option>Zrušená provozovatelem</option>
                      <option>Expirovala</option>
                    </select>
                  </th>
                  <th style="color:#9ca3af;font-weight:900;">—</th>
                  <th style="color:#9ca3af;font-weight:900;">—</th>
                  <th>
                    <div class="date-2">
                      <input id="fLastCmdFrom" class="fdate" type="date" title="Datum posledního příkazu – od">
                      <input id="fLastCmdTo" class="fdate" type="date" title="Datum posledního příkazu – do">
                    </div>
                  </th>
                  <th class="right" style="color:#9ca3af;font-weight:900;">—</th>
                </tr>

                <tr class="labels-row">
                  <th>Jméno uživatele</th>
                  <th>VS uživatele</th>
                  <th>Držitel karty</th>

                  <th>
                    <div class="th-flex">
                      <span>Datum vydání</span>
                      <span class="sort-arrows" aria-label="Řazení datum vydání">
                        <span class="sbtn" id="sortIssuedAsc" title="Řadit Datum vydání od nejstaršího">↑</span>
                        <span class="sbtn" id="sortIssuedDesc" title="Řadit Datum vydání od nejnovějšího">↓</span>
                      </span>
                    </div>
                  </th>

                  <th>Číslo karty</th>
                  <th>Stav karty</th>
                  <th>Platby kartou</th>
                  <th>Zamítnuté karetní příkazy</th>

                  <th>
                    <div class="th-flex">
                      <span>Datum posledního příkazu</span>
                      <span class="sort-arrows" aria-label="Řazení datum posledního příkazu">
                        <span class="sbtn" id="sortCmdAsc" title="Řadit Datum posledního příkazu od nejstaršího">↑</span>
                        <span class="sbtn" id="sortCmdDesc" title="Řadit Datum posledního příkazu od nejnovějšího">↓</span>
                      </span>
                    </div>
                  </th>

                  <th class="right">Editace</th>
                </tr>
              </thead>

              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    /*****************************************************************
     * KONFIGURACE ODKAZŮ (doplň si svoje URL šablony)
     * Placeholdery: {vs} {cardId} {cardMasked}
     *****************************************************************/
    const LINK_TEMPLATES = {
      userName:   "#", // např. "/admin/uzivatel/{vs}"
      holder:     "#", // např. "/admin/drzitel/{cardId}"
      payments:   "#", // např. "/admin/karty/{cardId}/transakce"
      rejected:   "#", // např. "/admin/karty/{cardId}/zamítnuté"
      edit:       "#", // např. "/admin/karty/{cardId}/edit"
    };
    function buildUrl(template, row){
      if (!template) return "#";
      return template
        .replaceAll("{vs}", String(row.vs))
        .replaceAll("{cardId}", String(row.cardId))
        .replaceAll("{cardMasked}", String(row.cardMasked));
    }

    /*****************************************************************
     * (3) UNIQUE "Jméno uživatele" + římské číslice (II, III, ...)
     *****************************************************************/
    function toRoman(n){
      // n >= 2
      const map = [
        [1000,"M"],[900,"CM"],[500,"D"],[400,"CD"],
        [100,"C"],[90,"XC"],[50,"L"],[40,"XL"],
        [10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]
      ];
      let x = n, out = "";
      for(const [v,s] of map){
        while(x >= v){ out += s; x -= v; }
      }
      return out;
    }
    function makeUniqueUserName(baseName, counts){
      const c = (counts[baseName] ?? 0) + 1;
      counts[baseName] = c;
      if (c === 1) return baseName;
      // druhý = (II), třetí = (III) ...
      return `${baseName} (${toRoman(c)})`;
    }

    function buildUserVariants(names, maxRepeat){
      const baseNames = [...new Set(names.map(stripRomanSuffix))]; // unikátní base
      const variants = [];
      for(const base of baseNames){
        for(let i=1;i<=maxRepeat;i++){
          variants.push(i === 1 ? base : `${base} (${toRoman(i)})`);
        }
      }
      return variants;
    }

    function stripRomanSuffix(name){
      return String(name).replace(/\s+\([IVXLCDM]+\)\s*$/i, "").trim();
    }


    /*****************************************************************
     * FAKE DATA (50 řádků)
     * issuedAt <= lastCommandAt
     * Držitel se může opakovat, UserName je unikátní (s římskými číslicemi)
     *****************************************************************/
    // "Speciální" jména, u kterých chceme občas vidět (II), (III)...
    const SPECIAL_BASE_NAMES = [
      "Patrik Denemark",
      "Jaroslav Fikar",
      "Jakub Studnička",
      "Monika Zezulová",
      "Adam Děkan"
    ];

    // náhodné české jméno+příjmení (aby bylo hodně různých lidí)
    const FIRST_NAMES = [
      "Pavel","Honza","Jan","Petr","Lukáš","Tomáš","Martin","Michal","David","Jakub","Vojtěch","Filip","Ondřej","Radek","Marek",
      "Tereza","Jana","Petra","Lucie","Monika","Veronika","Klára","Barbora","Eliška","Kateřina","Karolína","Adéla","Nikola","Kristýna","Anna"
    ];

    const LAST_NAMES = [
      "Vrba","Kočár","Novák","Svoboda","Dvořák","Černý","Procházka","Kučera","Veselý","Horák","Němec","Pokorný","Král","Růžička","Beneš",
      "Fiala","Sedláček","Jelínek","Kolář","Navrátil","Čermák","Vaněk","Šimek","Kříž","Blažek","Sýkora","Kratochvíl","Říha","Toman","Pospíšil"
    ];

    function randomCzechName(){
      const fn = FIRST_NAMES[randomInt(0, FIRST_NAMES.length-1)];
      const ln = LAST_NAMES[randomInt(0, LAST_NAMES.length-1)];
      return `${fn} ${ln}`;
    }

    const STATUSES = [
      "Vydaná bez nastavení",
      "Vydaná",
      "Blokovaná provozovatelem",
      "Blokovaná uživatelem",
      "Vydaná ve výpovědi",
      "Zrušená uživatelem",
      "Zrušená provozovatelem",
      "Expirovala"
    ];


    function pad(n){ return String(n).padStart(2,"0"); }
    function toISODate(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
    function maskCard(num16){
      const s = String(num16);
      return s.slice(0,6) + "******" + s.slice(-4);
    }
    function mulberry32(a){
      return function(){
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }
    const rnd = mulberry32(20260105);
    function randomInt(min, max){ return Math.floor(rnd()*(max-min+1))+min; }

    function stripRomanSuffix(name){
      // odstraní " (II)" / " (III)" atd. kdyby náhodou bylo v inputu
      return String(name).replace(/\s+\([IVXLCDM]+\)\s*$/i, "").trim();
    }

    function makeRows(count = 200){
      const rows = [];
      const base = new Date(2025, 10, 1); // 1.11.2025

      // kolik max variant (II..VI) dovolíme u "special" jmen
      const MAX_REPEAT_SPECIAL = 6;

      // 1) Postavíme si velký pool unikátních base jmen (random + special)
      const baseSet = new Set();

      // přidej special jména
      SPECIAL_BASE_NAMES.forEach(n => baseSet.add(n));

      // doplň random jména, aby bylo z čeho brát
      while (baseSet.size < Math.max(140, Math.min(180, count))) {
        baseSet.add(randomCzechName());
      }

      const baseNames = Array.from(baseSet);

      // 2) Vytvoříme "USER_VARIANTS" (unikátní userName), ale:
      // - special jména mohou mít (II..VI)
      // - ostatní random jména budou jen 1x (bez suffixu)
      const USER_VARIANTS = [];

      for (const bn of baseNames){
        if (SPECIAL_BASE_NAMES.includes(bn)){
          for (let i=1;i<=MAX_REPEAT_SPECIAL;i++){
            USER_VARIANTS.push(i===1 ? bn : `${bn} (${toRoman(i)})`);
          }
        } else {
          USER_VARIANTS.push(bn);
        }
      }

      // 3) Zamícháme a vezmeme prvních "count" => tím pádem NIKDY duplicitní userName
      for (let i = USER_VARIANTS.length - 1; i > 0; i--) {
        const j = randomInt(0, i);
        [USER_VARIANTS[i], USER_VARIANTS[j]] = [USER_VARIANTS[j], USER_VARIANTS[i]];
      }

      const picked = USER_VARIANTS.slice(0, Math.min(count, USER_VARIANTS.length));

      // 4) Sestav řádky
      for (let i=0; i<picked.length; i++){
        const userName = picked[i];
        const holderName = stripRomanSuffix(userName); // držitel bez závorek

        const vs = String(randomInt(41000000, 98999999));
        const status = STATUSES[randomInt(0, STATUSES.length-1)];

        const issued = new Date(base);
        issued.setDate(issued.getDate() + randomInt(0, 120));

        const lastCmd = new Date(issued);
        lastCmd.setDate(lastCmd.getDate() + randomInt(0, 60)); // vždy >= issued

        const cardId = 10000 + i;
        const cardNum = "474367" + String(randomInt(1000000000, 9999999999));
        const cardMasked = maskCard(cardNum);

        rows.push({
          cardId,
          userName,
          vs,
          holderName,
          issuedAt: toISODate(issued),
          cardMasked,
          status,
          lastCommandAt: toISODate(lastCmd),
        });
      }

      return rows;
    }


    const ALL_ROWS = makeRows(200);
    let VIEW_ROWS = [...ALL_ROWS];


    /*****************************************************************
     * RENDER
     *****************************************************************/
    const tbody = document.getElementById("tbody");
    const metaInfo = document.getElementById("metaInfo");

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function formatCzDate(iso){
      if(!iso) return "";
      const [y,m,d] = iso.split("-");
      return `${Number(d)}.${Number(m)}.${y}`;
    }

    function render(rows){
      const shell = document.getElementById("tableShell");
      const prevTop = shell.scrollTop;
      const prevLeft = shell.scrollLeft;

      tbody.innerHTML = rows.map(r => `
        <tr>
          <td><a class="link" href="${buildUrl(LINK_TEMPLATES.userName, r)}" data-noop>${escapeHtml(r.userName)}</a></td>
          <td>${escapeHtml(r.vs)}</td>
          <td><a class="link" href="${buildUrl(LINK_TEMPLATES.holder, r)}" data-noop>${escapeHtml(r.holderName)}</a></td>
          <td>${formatCzDate(r.issuedAt)}</td>
          <td>${escapeHtml(r.cardMasked)}</td>
          <td>${escapeHtml(r.status)}</td>
          <td><a class="link" href="${buildUrl(LINK_TEMPLATES.payments, r)}" data-noop>Výpis transakcí</a></td>
          <td><a class="link" href="${buildUrl(LINK_TEMPLATES.rejected, r)}" data-noop>Výpis zamítnutých transakcí</a></td>
          <td>${formatCzDate(r.lastCommandAt)}</td>
          <td class="right"><a href="${buildUrl(LINK_TEMPLATES.edit, r)}" data-noop><button class="edit-btn" title="Edit">✎</button></a></td>
        </tr>
      `).join("");

      metaInfo.innerHTML = `Zobrazeno: <b>${rows.length}</b> z <b>${ALL_ROWS.length}</b>`;
      shell.scrollTop = prevTop;
      shell.scrollLeft = prevLeft;
    }

    /*****************************************************************
     * Verze 1 filtry (aplikace po kliknutí)
     *****************************************************************/
    const el = (id) => document.getElementById(id);
    function normalize(s){ return String(s||"").trim().toLowerCase(); }
    function inRange(dateIso, fromIso, toIso){
      if(!dateIso) return true;
      if(fromIso && dateIso < fromIso) return false;
      if(toIso && dateIso > toIso) return false;
      return true;
    }

    // (4) Řazení přes šipky: udržujeme stav
    const sortState = { by: "", dir: "", manual: false }; // by: 'issuedAt'|'lastCommandAt', dir: 'asc'|'desc'
    function setSort(by, dir){
      sortState.by = by;
      sortState.dir = dir;
      sortState.manual = true;

      // UI aktivace
      const allBtns = ["sortIssuedAsc","sortIssuedDesc","sortCmdAsc","sortCmdDesc"].map(id => document.getElementById(id));
      allBtns.forEach(b => b.classList.remove("active"));

      if(by === "issuedAt" && dir === "asc") document.getElementById("sortIssuedAsc").classList.add("active");
      if(by === "issuedAt" && dir === "desc") document.getElementById("sortIssuedDesc").classList.add("active");
      if(by === "lastCommandAt" && dir === "asc") document.getElementById("sortCmdAsc").classList.add("active");
      if(by === "lastCommandAt" && dir === "desc") document.getElementById("sortCmdDesc").classList.add("active");
    }

    function applyFilters(){
      const fUserName = normalize(el("fUserName").value);
      const fVS       = normalize(el("fVS").value);
      const fHolder   = normalize(el("fHolder").value);
      const fCard      = normalize(el("fCard").value);
      const fStatus    = el("fStatus").value;

      const issuedFrom = el("fIssuedFrom").value;
      const issuedTo   = el("fIssuedTo").value;

      const cmdFrom    = el("fLastCmdFrom").value;
      const cmdTo      = el("fLastCmdTo").value;

      const nameFilterActive = fUserName.length > 0 || fHolder.length > 0;

      // auto řazení (pouze pokud admin nekliknul na šipky)
      if (!sortState.manual) {
        if (nameFilterActive) {
          // řadit podle jména jen při filtrování jména
          setSortAuto("userName", "asc");
        } else {
          // jinak vždy od nejmladší platby
          setSortAuto("lastCommandAt", "desc");
        }
      }

      let rows = ALL_ROWS.filter(r => {
        if (fUserName && !normalize(r.userName).includes(fUserName)) return false;
        if (fVS && !normalize(r.vs).includes(fVS)) return false;
        if (fHolder && !normalize(r.holderName).includes(fHolder)) return false;
        if (fCard && !normalize(r.cardMasked).includes(fCard)) return false;
        if (fStatus && r.status !== fStatus) return false;

        if (!inRange(r.issuedAt, issuedFrom, issuedTo)) return false;
        if (!inRange(r.lastCommandAt, cmdFrom, cmdTo)) return false;

        return true;
      });

      if (sortState.by){
        rows.sort((a,b) => {
          const av = a[sortState.by] || "";
          const bv = b[sortState.by] || "";
          if (av === bv) return 0;
          const cmp = av < bv ? -1 : 1;
          return sortState.dir === "asc" ? cmp : -cmp;
        });
      }

      VIEW_ROWS = rows;
      render(VIEW_ROWS);
    }

    function setSortAuto(by, dir){
      sortState.by = by;
      sortState.dir = dir;
      sortState.manual = false;

      // UI aktivace (stejné jako v setSort)
      const allBtns = ["sortIssuedAsc","sortIssuedDesc","sortCmdAsc","sortCmdDesc"].map(id => document.getElementById(id));
      allBtns.forEach(b => b.classList.remove("active"));

      if(by === "issuedAt" && dir === "asc") document.getElementById("sortIssuedAsc").classList.add("active");
      if(by === "issuedAt" && dir === "desc") document.getElementById("sortIssuedDesc").classList.add("active");
      if(by === "lastCommandAt" && dir === "asc") document.getElementById("sortCmdAsc").classList.add("active");
      if(by === "lastCommandAt" && dir === "desc") document.getElementById("sortCmdDesc").classList.add("active");
    }


    function resetFilters(){
      el("fUserName").value = "";
      el("fVS").value = "";
      el("fHolder").value = "";
      el("fCard").value = "";
      el("fStatus").value = "";

      el("fIssuedFrom").value = "";
      el("fIssuedTo").value = "";
      el("fLastCmdFrom").value = "";
      el("fLastCmdTo").value = "";

      setSort("", ""); // vypne řazení
      setSortAuto("lastCommandAt", "desc"); // default od nejmladší platby

      VIEW_ROWS = [...ALL_ROWS];
      render(VIEW_ROWS);
    }

    document.getElementById("btnFilter").addEventListener("click", applyFilters);
    document.getElementById("btnReset").addEventListener("click", resetFilters);
    // ENTER v jakémkoliv filtru = spustí Filtr
    document.querySelectorAll(".filters-row input, .filters-row select").forEach(elm => {
      elm.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          applyFilters();
        }
      });
    });


    // Sort arrow clicks
    document.getElementById("sortIssuedAsc").addEventListener("click", () => setSort("issuedAt","asc"));
    document.getElementById("sortIssuedDesc").addEventListener("click", () => setSort("issuedAt","desc"));
    document.getElementById("sortCmdAsc").addEventListener("click", () => setSort("lastCommandAt","asc"));
    document.getElementById("sortCmdDesc").addEventListener("click", () => setSort("lastCommandAt","desc"));

    // Sidebar hamburger toggle
    document.getElementById("hamburger").addEventListener("click", () => {
      document.body.classList.toggle("sidebar-collapsed");
    });

    // demo: nenecháme to nikam navigovat
    document.addEventListener("click", (e) => {
      const a = e.target.closest("a[data-noop]");
      if(a) e.preventDefault();
    });
    // defaultně třeba řadit Datum posledního příkazu od nejnovějšího
    setSortAuto("lastCommandAt","desc");
    applyFilters();
  </script>
</body>
</html>
