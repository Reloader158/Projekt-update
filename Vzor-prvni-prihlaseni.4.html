<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Onboarding v telefonu</title>
<style>
  :root{
    --blue:#2f74db; --blue-pressed:#2a66bf;
    --accent:#ff7b00; --ok:#1c7a2e; --muted:#6b7280;
    --card:#fff; --shadow:0 20px 60px rgba(0,0,0,.25);
    --phone-w:390px; --phone-h:844px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:#0f1115; display:grid; place-items:center;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif; color:#111;
  }

  .stage{ width:min(var(--phone-w), 95vw); aspect-ratio:390/844; position:relative; isolation:isolate; max-height:95vh; }
  .phone{ position:absolute; inset:0; border-radius:28px; box-shadow:0 18px 60px rgba(0,0,0,.45); overflow:hidden; background:#000; }
  .screen{ position:absolute; inset:0; background:#000 url('https://github.com/Reloader158/Projekt-update/blob/main/prehled.png?raw=true') center/cover no-repeat; }
  .notch{ position:absolute; top:8px; left:50%; transform:translateX(-50%); width:120px; height:18px; background:#000; border-radius:0 0 12px 12px; opacity:.4; pointer-events:none; z-index:2; }

  .scrim{ position:absolute; inset:0; background:rgba(0,0,0,.38); backdrop-filter:blur(2px); }
  .popup-wrap{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:18px }
  .popup{ width:min(560px, 92%); background:var(--card); border-radius:20px; box-shadow:var(--shadow); overflow:hidden; }
  .hd{ padding:18px 18px 8px; border-bottom:1px solid #eef0f4 }
  .title{ font-size:18px; font-weight:800 }
  .sub{ color:var(--muted); margin-top:4px; font-size:13px }
  .bd{ padding:14px 18px 6px }
  .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:12px 0; border-bottom:1px solid #f1f3f7 }
  .row:last-child{ border-bottom:none }
  .name{ font-weight:700 }
  .desc{ font-size:12px; color:var(--muted) }
  .status{ font-size:11px; font-weight:700; border-radius:999px; padding:4px 10px; white-space:nowrap }
  .st-bad{ background:#fff2e8; color:#9a4b00 }
  .st-ok{ background:#e8f7ed; color:#116d2b }
  .cta{ border:none; border-radius:999px; padding:10px 12px; font-weight:700; cursor:pointer }
  .cta-prim{ background:var(--blue); color:#fff; box-shadow:0 6px 16px rgba(47,116,219,.25) }
  .cta-ghost{ background:#eef3ff; color:#174796 }
  .actions{ display:flex; gap:10px; padding:14px 18px 18px }
  .btn{ flex:1; border:none; border-radius:999px; padding:12px 14px; font-weight:800; cursor:pointer }
  .btn-sec{ background:#e9e9e9 }
  .btn-primary{ background:var(--blue); color:#fff; box-shadow:0 6px 16px rgba(47,116,219,.25) }
  .btn-primary:active{ background:var(--blue-pressed) }
  .btn-primary[disabled]{ background:#cfd8ef; color:#fff; box-shadow:none; cursor:not-allowed; opacity:.8; pointer-events:none; }

  .footer-links{ display:flex; gap:16px; justify-content:center; padding:0 18px 16px }
  .link{ background:none; border:none; color:#174796; text-decoration:underline; cursor:pointer; font-size:12px }
  .summary{ margin-top:8px; background:#f6f7fb; border-radius:12px; padding:10px 12px; font-size:13px }

  .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.4); display:none; align-items:center; justify-content:center; padding:18px; z-index:30 }
  .modal{ width:min(400px, 92%); background:#fff; border-radius:20px; box-shadow:var(--shadow); overflow:hidden }
  .m-hd{ padding:16px 18px; border-bottom:1px solid #eef0f4; font-weight:800 }
  .m-bd{ padding:16px 18px }

  .ios-overlay{ position:absolute; inset:0; background:rgba(0,0,0,.25); backdrop-filter:blur(4px); display:none; align-items:center; justify-content:center; padding:18px; z-index:40 }
  .ios-alert{ width:min(400px, 92%); background:#fff; border-radius:22px; box-shadow:var(--shadow); overflow:hidden; text-align:center }
  .ios-body{ padding:22px 18px 16px }
  .ios-title{ font-weight:700; font-size:17px; line-height:1.35; margin-bottom:10px }
  .ios-text{ font-size:14px; opacity:.9 }
  .ios-actions{ display:flex; border-top:1px solid #e8e8ed }
  .ios-btn{ flex:1; padding:14px 8px; font-size:17px; color:#0a62ff; background:#fff; border:none; cursor:pointer }
  .ios-btn + .ios-btn{ border-left:1px solid #e8e8ed }

  .toast{ position:absolute; left:50%; bottom:22px; transform:translateX(-50%); background:#111; color:#fff; padding:8px 12px; border-radius:12px; opacity:0; transition:.25s; pointer-events:none; z-index:60; font-size:13px }
  .toast.show{ opacity:1 }

  /* ✅ mini dev toolbar pro přepínání stavů biometrie */
  .devbar{
    position:absolute; left:10px; right:10px; bottom:10px; z-index:70;
    display:flex; gap:8px; align-items:center;
    background:rgba(17,17,17,.65); color:#fff; padding:8px 10px; border-radius:12px;
    backdrop-filter: blur(2px);
    font-size:12px;
  }
  .devbar select{
    flex:1; padding:6px 8px; border-radius:8px; border:1px solid #555; background:#fff; color:#111;
  }

  @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
  .shake{ animation:shake .35s linear }

  /* ===================== PIN PAD (fullscreen sheet v našem stylu) ===================== */
  .pin-overlay{ position:absolute; inset:0; background:rgba(0,0,0,.48); display:none; align-items:center; justify-content:center; padding:18px; z-index:50 }
  .pin-sheet{ width:min(560px,92%); background:#fff; border-radius:22px; box-shadow:var(--shadow); padding:16px; display:grid; gap:14px }
  .pin-head{ text-align:center }
  .pin-title{ font-size:18px; font-weight:800 }
  .pin-sub{ font-size:14px; color:var(--muted) }

  .pin-dots{ display:flex; gap:10px; justify-content:center; margin-top:4px; min-height:16px }
  .pin-dot{ width:14px; height:14px; border-radius:50%; background:#e6eaf3 }
  .pin-dot.on{ background:#111 }

  .pin-keypad{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:6px }
  .pin-key{ padding:16px 0; border-radius:14px; background:#f1f3f8; text-align:center; font-weight:800; font-size:20px; user-select:none; cursor:pointer }
  .pin-key:active{ transform:scale(.98) }
  .pin-key.back{ font-size:16px; font-weight:700 }

  .pin-actions{ display:flex; justify-content:center; margin-top:2px }
  .pin-cancel{ border:none; border-radius:999px; padding:10px 14px; font-weight:700; background:#e9e9e9; cursor:pointer }

  /* ⚠️ Rezervované místo pro chybu – bez poskakování layoutu */
  .pin-error{
    text-align:center;
    color:#c62828;
    font-size:13px;
    min-height:18px;       /* výška pro 1 řádek textu */
    line-height:18px;
    visibility:hidden;     /* místo je drženo, text skrytý */
  }
  .pin-error.show{ visibility:visible; }
  .pin-sheet.shake{ animation:shake .35s linear }
</style>
</head>
<body>

  <div class="stage">
    <div class="phone">
      <div class="screen"></div>
      <div class="notch"></div>

      <!-- onboarding popup -->
      <div class="scrim"></div>
      <div class="popup-wrap" id="onboard">
        <div class="popup">
          <div class="hd">
            <div class="title">Vítejte v aplikaci Rychlá Peněženka</div>
            <div class="sub">Nastavte si <b>PIN</b> a povolte <b>Face ID / Otisk</b> pro rychlé a bezpečné ověřování.</div>
          </div>

          <div class="bd">
            <div class="row" id="rowPin">
              <div>
                <div class="name">PIN</div>
                <div class="desc">Krátký osobní kód pro přihlášení a potvrzování</div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <span id="pinStatus" class="status st-bad">Nenastaveno</span>
                <button id="btnPin" class="cta cta-prim">Nastavit PIN</button>
              </div>
            </div>

            <div class="row" id="rowBio">
              <div>
                <div class="name">Biometrie</div>
                <div class="desc">Face ID nebo otisk prstu pro pohodlné ověřování</div>
              </div>
              <div style="display:flex;gap:8px;align-items:center">
                <span id="bioStatus" class="status st-bad">Nenastaveno</span>
                <button id="btnBio" class="cta cta-ghost">Povolit biometrii</button>
              </div>
            </div>

            <div id="sum" class="summary" style="display:none">
              <b>Hotovo.</b> Budeme ověřovat: <span id="combo">PIN + Biometrie</span>. V Nastavení to můžete kdykoli změnit.
            </div>
          </div>

          <div class="actions">
            <button id="later" class="btn btn-sec">Připomenout později</button>
            <button id="continue" class="btn btn-primary" disabled aria-disabled="true">Pokračovat do nastavení</button>
          </div>
          <div class="footer-links">
            <button id="noThanks" class="link">Nechci</button>
          </div>
        </div>
      </div>

      <!-- ✅ FULLSCREEN PIN PAD -->
      <div class="pin-overlay" id="pinSetup">
        <div class="pin-sheet" id="pinSheet">
          <div class="pin-head">
            <div class="pin-title" id="pinTitle">Nastavte si PIN</div>
            <div class="pin-sub" id="pinSub">Zadejte 6 číslic</div>
          </div>

          <div class="pin-dots" id="pinDots"></div>
          <div class="pin-error" id="pinError">PINy se neshodují. Zkuste to znovu.</div>

          <div class="pin-keypad" id="pinKeys"><!-- build in JS --></div>

          <div class="pin-actions">
            <button class="pin-cancel" id="pinCancel">Zrušit</button>
          </div>
        </div>
      </div>

      <!-- iOS-like biometrie: souhlas -->
      <div class="ios-overlay" id="bioAlert">
        <div class="ios-alert">
          <div class="ios-body">
            <div class="ios-title">Chcete aplikaci „Rychlá Peněženka“ povolit používat Face ID / otisk prstu?</div>
            <div class="ios-text">Biometrie umožní rychlé ověřování pro přihlášení a potvrzování.</div>
          </div>
          <div class="ios-actions">
            <button id="bioDeny" class="ios-btn">Nepovolit</button>
            <button id="bioAllow" class="ios-btn">Povolit</button>
          </div>
        </div>
      </div>

      <!-- iOS-like: zařízení NEPODPORUJE biometriku -->
      <div class="ios-overlay" id="bioUnsupported">
        <div class="ios-alert">
          <div class="ios-body">
            <div class="ios-title">Biometrie není na tomto zařízení k dispozici</div>
            <div class="ios-text">Telefon nepodporuje Face ID ani otisk prstu. Pro pokračování použijte jiný způsob ověřování.</div>
          </div>
          <div class="ios-actions">
            <button class="ios-btn" id="bioUnsupBack">Zpět</button>
          </div>
        </div>
      </div>

      <!-- iOS-like: biometrie podporovaná, ale NENÍ nastavená -->
      <div class="ios-overlay" id="bioNotEnrolled">
        <div class="ios-alert">
          <div class="ios-body">
            <div class="ios-title">Biometrie není v telefonu nastavená</div>
            <div class="ios-text">Abyste mohli používat Face ID / otisk v aplikaci, nejdřív ji nastavte v nastavení telefonu.</div>
          </div>
          <div class="ios-actions">
            <button class="ios-btn" id="bioEnrollBack">Zpět</button>
            <button class="ios-btn" id="bioGoSettings">Přejít do nastavení</button>
          </div>
        </div>
      </div>

      <div class="toast" id="toast">Uloženo</div>

      <!-- ✅ DEV TOOLBAR: přepnutí stavu biometrie -->
      <div class="devbar">
        <span>Test: Stav biometrie</span>
        <select id="bioState">
          <option value="ok">Podporováno & nastaveno</option>
          <option value="noEnroll" selected>Podporováno & nenastaveno</option>
          <option value="noSupport">Nepodporováno (skrýt řádek)</option>
        </select>
      </div>

    </div>
  </div>

<script>
  let hasPin=false, hasBio=false;

  // SIMULACE stavu zařízení (mění se dropdownem)
  let deviceSupportsBio = true;   // telefon umí Face/otisk?
  let osBioEnrolled    = false;   // Face/otisk nastaven v OS?

  const pinStatus=document.getElementById('pinStatus');
  const bioStatus=document.getElementById('bioStatus');
  const btnPin=document.getElementById('btnPin');
  const btnBio=document.getElementById('btnBio');
  const btnContinue=document.getElementById('continue');
  const sum=document.getElementById('sum');
  const rowBio=document.getElementById('rowBio');

  const bioAlert = document.getElementById('bioAlert');
  const bioUnsupported = document.getElementById('bioUnsupported');
  const bioNotEnrolled = document.getElementById('bioNotEnrolled');

  function applyBioVisibility(){
    // skryj/ukaž řádek Biometrie v hlavním popupu
    rowBio.style.display = deviceSupportsBio ? '' : 'none';
    const sub = document.querySelector('.sub');
    if(!deviceSupportsBio){
      sub.innerHTML = 'Nastavte si <b>PIN</b> pro rychlé a bezpečné ověřování.';
      hasBio = false;
    } else {
      sub.innerHTML = 'Nastavte si <b>PIN</b> a povolte <b>Face ID / Otisk</b> pro rychlé a bezpečné ověřování.';
    }
    updateUI();
  }

  function updateUI(){
    pinStatus.textContent = hasPin ? 'Připraveno' : 'Nenastaveno';
    pinStatus.className = 'status ' + (hasPin?'st-ok':'st-bad');
    btnPin.textContent   = hasPin ? 'Změnit PIN' : 'Nastavit PIN';
    btnPin.className     = 'cta ' + (hasPin?'cta-ghost':'cta-prim');

    bioStatus.textContent = hasBio ? 'Připraveno' : 'Nenastaveno';
    bioStatus.className   = 'status ' + (hasBio?'st-ok':'st-bad');
    btnBio.textContent    = hasBio ? 'Změnit nastavení' : 'Povolit biometrii';
    btnBio.className      = 'cta ' + (hasBio?'cta-prim':'cta-ghost');

    const both = hasPin && hasBio;
    btnContinue.disabled = !both;
    btnContinue.setAttribute('aria-disabled', String(!both));
    sum.style.display = both ? 'block' : 'none';
  }

  function toast(msg){
    const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
    clearTimeout(toast._t); toast._t=setTimeout(()=>t.classList.remove('show'),1800);
  }

  // ====== FULLSCREEN PIN PAD LOGIC (6-místný PIN) ======
  (function(){
    const PIN_LEN = 6;

    const root  = document.getElementById('pinSetup');
    const sheet = document.getElementById('pinSheet');
    const sub   = document.getElementById('pinSub');
    const dots  = document.getElementById('pinDots');
    const error = document.getElementById('pinError');
    const keys  = document.getElementById('pinKeys');
    const cancel= document.getElementById('pinCancel');

    let phase='first';     // 'first' → 'confirm'
    let firstPin='', buf='';

    function renderDots(){
      const len = Math.min(buf.length, PIN_LEN);
      dots.innerHTML = Array.from({length:PIN_LEN}, (_,i)=>`<div class="pin-dot ${i<len?'on':''}"></div>`).join('');
    }

    function buildKeys(){
      const layout = ['1','2','3','4','5','6','7','8','9','back','0'];
      keys.innerHTML = layout.map(k=> k==='back'
        ? `<div class="pin-key back" data-k="back">⌫</div>`
        : `<div class="pin-key" data-k="${k}">${k}</div>`).join('');
      keys.onclick = (e)=>{
        const k = e.target?.dataset?.k;
        if(!k) return;
        if(k==='back'){
          if(buf.length){
            buf = buf.slice(0,-1);
            error.classList.remove('show');
            renderDots();
          }
          return;
        }
        if(buf.length>=PIN_LEN) return; // max 6
        buf += k;
        renderDots();
        error.classList.remove('show');

        // přechod až po přesně 6 číslicích
        if(phase==='first' && buf.length===PIN_LEN){
          firstPin = buf;
          setTimeout(()=>{ buf=''; phase='confirm'; sub.textContent='Potvrďte PIN znovu'; renderDots(); }, 100);
        }else if(phase==='confirm' && buf.length===PIN_LEN){
          if(buf===firstPin){
            hasPin = true;
            root.style.display='none';
            updateUI();
            toast('PIN nastaven');
          }else{
            // nesoulad → shake + reset bez dalšího klikání
            error.classList.add('show');
            sheet.classList.remove('shake'); void sheet.offsetWidth; sheet.classList.add('shake');
            setTimeout(()=>{ phase='first'; firstPin=''; buf=''; sub.textContent='Zadejte 6 číslic'; renderDots(); }, 380);
          }
        }
      };
    }

    function open(){
      phase='first'; firstPin=''; buf='';
      sub.textContent='Zadejte 6 číslic';
      error.classList.remove('show');
      renderDots();
      if(!keys.childElementCount) buildKeys();
      root.style.display='flex';
    }
    function close(){ root.style.display='none'; }

    cancel.addEventListener('click', close);
    window.openPinSetup = open;  // napojíme na tlačítko
  })();

  // Biometrie – tři stavy
  btnBio.addEventListener('click', () => {
    if (!deviceSupportsBio) {
      document.getElementById('bioUnsupported').style.display = 'flex';
      return;
    }
    if (!osBioEnrolled) {
      document.getElementById('bioNotEnrolled').style.display = 'flex';
      return;
    }
    document.getElementById('bioAlert').style.display = 'flex';
  });

  // Zavírání dialogů biometrie
  document.getElementById('bioUnsupBack').addEventListener('click', ()=> {
    document.getElementById('bioUnsupported').style.display = 'none';
  });
  document.getElementById('bioEnrollBack').addEventListener('click', ()=> {
    document.getElementById('bioNotEnrolled').style.display = 'none';
  });
  document.getElementById('bioGoSettings').addEventListener('click', ()=> {
    toast('Otevřete Nastavení telefonu → Zabezpečení → Biometrie.');
    document.getElementById('bioNotEnrolled').style.display = 'none';
  });

  document.getElementById('bioDeny').addEventListener('click', ()=> document.getElementById('bioAlert').style.display='none');
  document.getElementById('bioAllow').addEventListener('click', ()=>{ 
    hasBio=true; 
    document.getElementById('bioAlert').style.display='none'; 
    updateUI(); 
    toast('Biometrie povolena'); 
  });

  // spodní akce
  document.getElementById('later').addEventListener('click', ()=>{ toast('Připomeneme později'); document.getElementById('onboard').style.display='none'; });
  document.getElementById('noThanks').addEventListener('click', ()=>{ toast('Můžete kdykoli změnit v Nastavení'); document.getElementById('onboard').style.display='none'; });
  btnContinue.addEventListener('click', ()=>{ if(btnContinue.disabled) return; toast('Hotovo – PIN + Biometrie'); document.getElementById('onboard').style.display='none'; });

  // ✅ Dev dropdown – přepínání stavů biometrie
  const bioState = document.getElementById('bioState');
  bioState.addEventListener('change', (e)=>{
    const v = e.target.value;
    if(v==='ok'){ deviceSupportsBio=true; osBioEnrolled=true; }
    if(v==='noEnroll'){ deviceSupportsBio=true; osBioEnrolled=false; }
    if(v==='noSupport'){ deviceSupportsBio=false; osBioEnrolled=false; hasBio=false; }
    // zavři případné otevřené dialogy
    [bioAlert,bioUnsupported,bioNotEnrolled].forEach(el=> el.style.display='none');
    applyBioVisibility();
    toast('Režim biometrie: ' + e.target.options[e.target.selectedIndex].text);
  });

  // napojení tlačítka „Nastavit PIN“ na fullscreen PIN-pad
  btnPin.addEventListener('click', ()=>{ if(typeof openPinSetup==='function') openPinSetup(); });

  // init
  applyBioVisibility();
</script>
</body>
</html>
