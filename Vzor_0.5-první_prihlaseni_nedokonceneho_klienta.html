<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Průvodce nahráním dokladů</title>
<style>
  :root{
    --blue:#2f74db; --blue-pressed:#2a66bf;
    --accent:#ff7b00; --ok:#1b7f3b; --bad:#b33a3a; --muted:#6b7280;
    --card:#fff; --shadow:0 20px 60px rgba(0,0,0,.25);
    --phone-w:390px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#0f1115;display:grid;place-items:center;
       font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;color:#111}

  /* Phone stage */
  .stage{width:min(var(--phone-w),95vw);aspect-ratio:390/844;position:relative;max-height:95vh}
  .phone{position:absolute;inset:0;border-radius:28px;overflow:hidden;background:#000;box-shadow:0 18px 60px rgba(0,0,0,.45)}
  .screen{position:absolute;inset:0;background:#000 url('prehled.png') center/cover no-repeat;filter:blur(2px) brightness(.85)}
  .notch{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:120px;height:18px;background:#000;border-radius:0 0 12px 12px;opacity:.4;pointer-events:none;z-index:2}

  /* Wizard */
  .scrim{position:absolute;inset:0;background:rgba(0,0,0,.35)}
  .wizard{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:18px}
  .card{width:min(560px,92%);background:var(--card);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}

  .header{display:flex;align-items:center;gap:10px;padding:14px 16px;border-bottom:1px solid #eef0f4}
  .back{border:none;background:#f1f3f8;border-radius:12px;padding:8px 12px;cursor:pointer;font-weight:600}
  .close{margin-left:auto;border:none;background:#f1f3f8;border-radius:12px;padding:8px 12px;cursor:pointer;font-weight:600}
  .step{font-size:12px;color:#555}
  .progress{height:4px;background:#edf0f6;border-radius:999px;overflow:hidden;margin:0 16px}
  .bar{height:100%;width:0;background:var(--blue);transition:.25s}

  .body{padding:16px}
  .title{font-size:20px;font-weight:800;margin-bottom:6px}
  .sub{font-size:14px;color:var(--muted);margin-bottom:12px}
  .row{display:flex;align-items:center;gap:10px}
  .btn{border:none;border-radius:999px;padding:12px 16px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--blue);color:#fff;box-shadow:0 6px 16px rgba(47,116,219,.25)}
  .btn-primary:active{background:var(--blue-pressed)}
  .btn-ghost{background:#eef3ff;color:#174796}
  .btn-light{background:#e9e9e9}
  .btn[disabled]{opacity:.6;cursor:not-allowed;box-shadow:none}
  .grid{display:grid;gap:12px}

  .doc{border:1px solid #edf0f4;border-radius:14px;padding:12px}
  .doc .hd{display:flex;align-items:center;gap:10px}
  .badge{margin-left:auto;font-size:12px;font-weight:700;border-radius:999px;padding:4px 10px}
  .b-pending{background:#fff2e6;color:#9a4b00}
  .b-ok{background:#e8f7ed;color:#116d2b}
  .b-bad{background:#fdebea;color:#b33a3a}
  .preview{height:120px;border:1px dashed #d7dbe6;border-radius:12px;display:grid;place-items:center;color:#95a0b5;background:#fafbfd;margin-top:10px;overflow:hidden}
  .preview img{max-width:100%;max-height:100%;display:block}

  .footer{display:flex;gap:10px;padding:14px 16px;border-top:1px solid #eef0f4}
  .hint{font-size:12px;color:#6b7280}

  /* Fake camera */
  .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
  .modal{width:min(420px,92%);background:#fff;border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  .mhd{padding:14px 16px;border-bottom:1px solid #eef0f4;font-weight:800}
  .mbd{padding:16px}
  .frame{height:180px;border:3px dashed #7a859a;border-radius:12px;display:grid;place-items:center;margin-bottom:12px;color:#7a859a}
  .mactions{display:flex;gap:10px;padding:14px 16px;border-top:1px solid #eef0f4}

  .toast{position:absolute;left:50%;bottom:22px;transform:translateX(-50%);background:#111;color:#fff;padding:8px 12px;border-radius:12px;opacity:0;transition:.25s;pointer-events:none;z-index:80;font-size:13px}
  .toast.show{opacity:1}

  .hidden{display:none !important}

  /* přidej */
  #progressWrap{
    display:flex;
    flex-direction:column;
    align-items:center;   /* vycentruje text na lištu */
    flex:1;               /* roztáhne se mezi Zpět a Zavřít */
  }

  /* pokud máš u .progress in-line width, dej ho do CSS */
  .progress{
    width:200px;          /* stejné jako dřív (můžeš změnit podle potřeby) */
    margin:0 16px;        /* může být i margin: 0 auto; */
  }
  .step{
    text-align:center;    /* jistota centrování textu */
}

</style>
</head>
<body>
  <div class="stage">
    <div class="phone">
      <div class="screen"></div>
      <div class="notch"></div>
      <div class="scrim" id="scrim"></div>

      <div class="wizard" id="wizard">
        <div class="card">
          <!-- header -->
          <div class="header" id="header">
            <button class="back" id="backBtn" disabled>Zpět</button>
            <div id="progressWrap">
              <div class="step" id="stepText">Krok 0/4</div>
              <div class="progress" style="width:200px"><div class="bar" id="bar"></div></div>
            </div>
            <button class="close" id="closeBtn">Zavřít</button>
          </div>

          <!-- body -->
          <div class="body" id="view"><!-- dynamic --></div>

          <!-- footer -->
          <div class="footer" id="footer">
            <button class="btn btn-light" id="laterBtn">Později</button>
            <button class="btn btn-primary" id="nextBtn">Pokračovat</button>
          </div>
        </div>
      </div>

      <!-- fake camera -->
      <div class="overlay" id="cam">
        <div class="modal">
          <div class="mhd">Fotoaparát</div>
          <div class="mbd">
            <div class="frame">Zarovnejte doklad do rámečku</div>
            <div class="hint">Pro demo se po „Vyfotit“ vygeneruje náhled a spustí pseudo-OCR.</div>
          </div>
          <div class="mactions">
            <button class="btn btn-light" id="camCancel">Zrušit</button>
            <button class="btn btn-primary" id="camShoot">Vyfotit</button>
          </div>
        </div>
      </div>

      <div class="toast" id="toast">Uloženo</div>
    </div>
  </div>

<script>
/* --------- STATE --------- */
let step = 0; // 0..4
const totalSteps = 3;

const docs = {
  frontID: {
    title: "Občanský průkaz — přední strana",
    desc: "Nahrajte čitelnou přední stranu občanského průkazu. Doklad musí být celý v záběru.",
    file: null, status: "pending", img: null
  },
  backID: {
    title: "Občanský průkaz — zadní strana",
    desc: "Nahrajte čitelnou zadní stranu Vašeho průkazu. Doklad musí být celý v rámečku.",
    file: null, status: "pending", img: null
  },
  extra: {
    title: "Druhý identifikační doklad",
    desc: "Lze použít cestovní pas, řidičský průkaz, rodný list nebo kartička pojištěnce.",
    hint: "Nahrajte čitelně hlavní stranu Vašeho dokumentu. Doklad musí být celý v rámečku.",
    file: null, status: "pending", img: null
  }
};
stepOrder=["frontID","backID","extra"];

/* --------- EL --------- */
const wizard=document.getElementById('wizard');
const scrim =document.getElementById('scrim');
const header=document.getElementById('header');
const view  =document.getElementById('view');
const bar   =document.getElementById('bar');
const stepText=document.getElementById('stepText');
const backBtn =document.getElementById('backBtn');
const nextBtn =document.getElementById('nextBtn');
const closeBtn=document.getElementById('closeBtn');
const laterBtn=document.getElementById('laterBtn');
const footer  =document.getElementById('footer');
const cam =document.getElementById('cam');
const camCancel=document.getElementById('camCancel');
const camShoot =document.getElementById('camShoot');
const toast=document.getElementById('toast');
const progressWrap=document.getElementById('progressWrap');

/* --------- OPEN/CLOSE --------- */
// zobrazit vždy, pokud není odložené v aktuální session
function shouldOpenWizard(){
  return sessionStorage.getItem('docsWizardSnoozed')!=='1';
}
function closeWizard(){ wizard.classList.add('hidden'); }
function openWizard(){ wizard.classList.remove('hidden'); }

/* --------- PROGRESS & LAYOUT --------- */
function setProgress(){
  if(step===0){
    // úvod: bez back/progress/close a bez Next v patičce
    backBtn.classList.add('hidden');
    progressWrap.classList.add('hidden');
    closeBtn.classList.add('hidden');
    nextBtn.classList.add('hidden');
    footer.classList.remove('hidden');
  }else if(step===4){
    // finále: bez headeru i footeru
    header.classList.add('hidden');
    footer.classList.add('hidden');
  }else{
    header.classList.remove('hidden');
    backBtn.classList.remove('hidden');
    progressWrap.classList.remove('hidden');
    closeBtn.classList.remove('hidden');
    footer.classList.remove('hidden');
    nextBtn.classList.remove('hidden');

    const pct=(step/totalSteps)*100;
    bar.style.width=pct+'%';
    stepText.textContent=`Krok ${step}/${totalSteps}`;
  }
  backBtn.disabled=(step<=0);
  nextBtn.textContent=(step===3?"Odeslat ke schválení":"Pokračovat");
}

/* --------- VIEWS --------- */
function uiIntro(){
  view.innerHTML=[
    '<div class="title">Vítejte v aplikaci Rychlá Peněženka!</div>',
    '<div class="sub">Nyní nahrajte požadované doklady pomocí tohoto průvodce nebo přímo v sekci <b>Moje dokumenty</b>.</div>',
    '<div class="grid">',
      '<button class="btn btn-primary" id="startHere">Nahrát doklady zde</button>',
      '<button class="btn btn-ghost" id="goDocs">Přejít do „Moje dokumenty“</button>',
    '</div>'
  ].join('');
  document.getElementById('startHere').onclick=()=>{ step=1; render(); };
  document.getElementById('goDocs').onclick=()=> showToast('Otevřela by se sekce Moje dokumenty.');
}

function docCard(key){
  const d=docs[key];
  const statusClass=(d.status==='ok')?'b-ok':(d.status==='bad'?'b-bad':'b-pending');
  const statusText =(d.status==='ok')?'OK':(d.status==='bad'?'Nečitelné':'Nenahráno');

  view.innerHTML=[
    '<div class="title">',d.title,'</div>',
    (d.hint?'<div class="sub">'+d.hint+'</div>':''),
    '<div class="doc">',
      '<div class="hd">',
        `<div class="sub">${d.desc || 'Nahraj čitelnou přední stranu. Doklad musí být celý v záběru.'}</div>`,
        '<span class="badge ',statusClass,'">',statusText,'</span>',
      '</div>',
      '<div class="row" style="margin-top:10px">',
        '<input type="file" accept="image/*" id="file" style="display:none">',
        '<button class="btn btn-ghost" id="uploadBtn">Nahrát</button>',
        '<button class="btn btn-primary" id="photoBtn">Vyfotit</button>',
      '</div>',
      '<div class="preview" id="preview">', (d.img?'<img src="'+d.img+'">':'Žádný náhled') ,'</div>',
      '<div class="sub" id="ocrMsg"></div>',
    '</div>'
  ].join('');

  document.getElementById('uploadBtn').onclick=()=> document.getElementById('file').click();
  document.getElementById('file').onchange=(e)=>{
    const f=e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=(ev)=>{ setDocImage(key,ev.target.result); runOCR(key); };
    r.readAsDataURL(f);
  };

  document.getElementById('photoBtn').onclick=()=>{
    cam.style.display='flex';
    camShoot.onclick=()=>{
      cam.style.display='none';
      const img=genPlaceholderImage();
      setDocImage(key,img);
      runOCR(key);
    };
  };
  camCancel.onclick=()=> cam.style.display='none';

  nextBtn.disabled=(d.status!=='ok');
}

function uiSecurityQuestion(){
  view.innerHTML=[
    '<div class="title">Doklady odeslány ke schválení</div>',
    '<div class="sub">Chceš nyní nastavit vícefaktorové ověřování (např. PIN + Biometrie) pro vyšší zabezpečení?</div>',
    '<div class="grid">',
      '<button class="btn btn-primary" id="goSecurity">Nastavit nyní</button>',
      '<button class="btn btn-light" id="laterSec">Později</button>',
    '</div>'
  ].join('');

  document.getElementById('goSecurity').onclick=()=>{
    window.location.assign('https://reloader158.github.io/Projekt-update/Vzor-prvni-prihlaseni.4.html');
  };
  document.getElementById('laterSec').onclick=()=>{
    showToast('Můžeš kdykoli později v Nastavení.');
    closeWizard();
  };
}

/* --------- HELPERS --------- */
function setDocImage(key,dataUrl){
  docs[key].img=dataUrl;
  const prev=document.getElementById('preview');
  if(prev) prev.innerHTML=`<img src="${dataUrl}">`;
}
function runOCR(key){
  const msg=document.getElementById('ocrMsg');
  if(msg) msg.textContent="Kontrolujeme čitelnost…";
  docs[key].status="pending"; updateBadge("pending");
  setTimeout(()=>{
    const ok=Math.random()<0.8;
    docs[key].status=ok?"ok":"bad";
    updateBadge(docs[key].status);
    if(msg) msg.textContent= ok?"Vypadá to dobře.":"Text je hůře čitelný. Zkuste lepší světlo nebo zaostřit a vyfoťte znovu.";
    nextBtn.disabled=!ok;
  },700);

  function updateBadge(state){
    const b=document.querySelector('.badge'); if(!b) return;
    if(state==="ok"){ b.className="badge b-ok"; b.textContent="OK"; }
    else if(state==="bad"){ b.className="badge b-bad"; b.textContent="Nečitelné"; }
    else { b.className="badge b-pending"; b.textContent="Nenahráno"; }
  }
}
function genPlaceholderImage(){
  const c=document.createElement('canvas'); c.width=600; c.height=380;
  const x=c.getContext('2d');
  x.fillStyle="#f1f5fb"; x.fillRect(0,0,c.width,c.height);
  x.strokeStyle="#8fa2bf"; x.lineWidth=6; x.strokeRect(12,12,c.width-24,c.height-24);
  x.fillStyle="#334155"; x.font="28px system-ui, -apple-system, Segoe UI, Roboto";
  x.fillText("Náhled dokladu",20,60);
  x.fillStyle="#64748b"; x.font="18px system-ui"; x.fillText("Demo obrázek (fotoaparát)",20,92);
  return c.toDataURL();
}
function showToast(t){
  toast.textContent=t; toast.classList.add('show'); clearTimeout(showToast._t);
  showToast._t=setTimeout(()=>toast.classList.remove('show'),1700);
}

/* --------- NAV --------- */
function render(){
  if(!shouldOpenWizard()){ closeWizard(); return; } else { openWizard(); }

  // reset header/footer visibility before switching
  header.classList.remove('hidden'); footer.classList.remove('hidden');

  setProgress();
  if(step===0) uiIntro();
  else if(step>=1 && step<=3) docCard(stepOrder[step-1]);
  else if(step===4) uiSecurityQuestion();
}

/* Handlery */
backBtn.onclick=()=>{ if(step>0){ step--; render(); } };
nextBtn.onclick=()=>{
  if(step>=1 && step<=3){
    const key=stepOrder[step-1];
    if(docs[key].status!=="ok"){ showToast("Nejprve nahraj a potvrď čitelnou fotku."); return; }
    if(step===3){ showToast("Odesláno ke schválení"); step=4; }
    else{ step++; }
    render();
  }
};
laterBtn.onclick=()=>{
  if(step===0){
    sessionStorage.setItem('docsWizardSnoozed','1');
    closeWizard();
  }else{
    showToast("Připomeneme později");
  }
};
closeBtn.onclick=()=>{ showToast("Průvodce uzavřen"); closeWizard(); };
scrim.addEventListener('click',()=>{
  if(step===0){
    sessionStorage.setItem('docsWizardSnoozed','1');
    closeWizard();
  }
});

/* INIT */
render();
</script>
</body>
</html>
