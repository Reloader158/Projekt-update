<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nastavení</title>
<style>
  :root{
    --blue:#2f74db; --blue-pressed:#2a66bf;
    --card:#ffffff; --bg:#f6f7fb; --muted:#666; --divider:#eee;
    --switch-on:#ff7b00;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:var(--bg);color:#111}

  .page{max-width:480px;margin:0 auto;padding:12px}
  .card{background:var(--card);border-radius:16px;box-shadow:0 4px 18px rgba(0,0,0,.06);padding:18px;margin:12px 0 20px}
  h1{font-size:36px;margin:6px 6px 4px;font-weight:700}
  .card h2{font-size:28px;text-align:center;margin:4px 0 18px}

  .btn{
    appearance:none;border:none;width:100%;
    background:var(--blue);color:#fff;padding:14px 16px;margin:8px 0;
    border-radius:26px;font-size:18px;font-weight:600;box-shadow:0 6px 16px rgba(47,116,219,.25);cursor:pointer;
  }
  .btn:active{background:var(--blue-pressed)}
  .btn-secondary{background:#eaf1ff;color:#174796;box-shadow:none}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  .row{display:flex;align-items:center;justify-content:space-between;padding:14px 6px;border-bottom:1px solid var(--divider)}
  .row:last-child{border-bottom:none}
  .row .label{font-size:18px;line-height:1.3}
  .hint{font-size:13px;color:var(--muted);margin-top:4px}

  .switch{position:relative;width:48px;height:26px;flex:0 0 auto}
  .switch input{opacity:0;width:0;height:0}
  .slider{position:absolute;inset:0;border-radius:26px;background:#ccc;transition:.3s}
  .slider:before{content:"";position:absolute;width:20px;height:20px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.3s;box-shadow:0 1px 2px rgba(0,0,0,.2)}
  .switch input:checked + .slider{background:var(--switch-on)}
  .switch input:checked + .slider:before{transform:translateX(22px)}

  .info{background:#f4f6fb;border:1px solid #e6ecfb;border-radius:12px;padding:10px 12px;margin:10px 0;font-size:15px}
  .info strong{display:block;margin-bottom:4px}

  /* oranžový box – jednofaktor */
  .info.onefactor{margin-top:14px;background:#fff8f2;border:1px solid #ffe1c2;border-radius:12px;padding:12px}
  .onefactor-head{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .onefactor .row{background:transparent;border-bottom:1px solid #ffe6cf;padding:12px 4px}
  .onefactor .row:last-child{border-bottom:none}
  .onefactor.disabled{opacity:.6}
  .onefactor.disabled .lockable{pointer-events:none}
  .onefactor .note{font-size:13px;color:#9a4b00;margin:4px 2px 8px}

  /* modal */
  .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.25);backdrop-filter:blur(4px);z-index:999;align-items:center;justify-content:center}
  .modal{background:#fff;border-radius:20px;max-width:420px;width:90%;padding:20px;box-shadow:0 12px 40px rgba(0,0,0,.2)}
  .modal h3{margin:0 0 10px;text-align:center}
  .modal .field{margin:10px 0}
  .modal input{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font-size:16px;text-align:center;letter-spacing:2px}
  .modal .row-btns{display:flex;gap:10px;margin-top:12px}
  .modal .btn{margin:0;border-radius:14px}
  .error{display:none;margin-top:8px;font-size:13px;background:#fdecea;border:1px solid #f5c2c0;color:#c62828;border-radius:10px;padding:8px 10px}
</style>
</head>
<body>
  <div class="page">
    <h1>Nastavení</h1>

    <section class="card">
      <h2>Nastavení bezpečnosti</h2>
      <button class="btn">Změnit heslo</button>
      <button class="btn">Nastavení PIN kódu</button>
      <button class="btn">Nastavení biometrie</button>
    </section>

    <section class="card">
      <h2>Nastavení silného ověření</h2>

      <div class="info">
        <strong>Aktuální stav zabezpečení</strong>
        PIN + Biometrie (Face ID / Otisk)
      </div>

      <button class="btn btn-secondary">Změnit faktory ověření</button>

      <div class="info">
        <strong>Obnovovací faktory (pro reset)</strong>
        SMS + Heslo
      </div>

      <!-- Jednofaktor -->
      <div class="info onefactor" id="onefactorBox">
        <div class="onefactor-head">
          <div>
            <strong>Používat pouze jedno faktorové ověřování</strong>
            <div class="hint">Zvolte, který faktor chcete používat, a vyberte akce níže.</div>
          </div>
          <label class="switch">
            <input id="oneFactorToggle" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>

        <button class="btn btn-secondary lockable" id="chooseFactorBtn" disabled>Vybrat faktor</button>
        <div class="note lockable" id="oneFactorNote" style="display:none">Nejprve vyberte faktor, potom zvolte akci.</div>

        <div class="row">
          <div class="label">Přihlášení</div>
          <label class="switch">
            <input class="actionSwitch lockable" type="checkbox" disabled>
            <span class="slider"></span>
          </label>
        </div>
        <div class="row">
          <div class="label">Potvrzení transakcí</div>
          <label class="switch">
            <input class="actionSwitch lockable" type="checkbox" disabled>
            <span class="slider"></span>
          </label>
        </div>
        <div class="row">
          <div class="label">Zobrazení údajů karty</div>
          <label class="switch">
            <input class="actionSwitch lockable" type="checkbox" disabled>
            <span class="slider"></span>
          </label>
        </div>

        <!-- NOVÉ tlačítko -->
        <button class="btn lockable" id="activateOneFactor" disabled>Aktivovat jednofaktor</button>
      </div>
    </section>

    <section class="card">
      <h2>Nastavení upozornění a oznámení</h2>

      <div class="row">
        <div class="label">Nastavení oznámení<div class="hint">Obecná notifikace aplikace</div></div>
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
      <div class="row">
        <div class="label">Neúspěšné platby</div>
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
      <div class="row">
        <div class="label">Změna limitů</div>
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
      <div class="row">
        <div class="label">Vyčerpání limitů</div>
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
      <div class="row">
        <div class="label">Ostatní oznámení</div>
        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
      </div>
    </section>
  </div>

  <!-- Modal: výběr faktoru -->
  <div id="factorModal" class="overlay">
    <div class="modal">
      <h3>Vyberte faktor ověření</h3>
      <div id="factorList" style="display:flex;flex-direction:column;">
        <div class="factor-item">PIN kód</div>
        <div class="factor-item">Face ID</div>
        <div class="factor-item">Otisk prstu</div>
        <div class="factor-item">Heslo + SMS kód</div>
      </div>
      <div class="row-btns">
        <button id="cancelFactor" class="btn btn-secondary">Zrušit</button>
      </div>
    </div>
  </div>

  <!-- Modal: SMS potvrzení -->
  <div id="smsModal" class="overlay">
    <div class="modal">
      <h3>Potvrzení přes SMS</h3>
      <div class="hint" style="text-align:center">Poslali jsme kód na vaše ověřené číslo. (Demo: <b>123456</b>)</div>
      <div class="field"><input id="smsCode" type="text" inputmode="numeric" placeholder="Zadejte 6-místný kód"></div>
      <div id="smsError" class="error">Neplatný kód. Zkuste to znovu.</div>
      <div class="row-btns">
        <button id="smsCancel" class="btn btn-secondary">Zrušit</button>
        <button id="smsConfirm" class="btn">Potvrdit</button>
      </div>
    </div>
  </div>

<style>
  .factor-item{padding:14px 20px;font-size:17px;border-bottom:1px solid #eee;cursor:pointer;transition:background .2s}
  .factor-item:last-child{border-bottom:none}
  .factor-item:hover{background:#f4f6fb}
</style>

<script>
  // Elementy – jednofaktor
  const onefactorBox    = document.getElementById('onefactorBox');
  const oneFactorToggle = document.getElementById('oneFactorToggle');
  const chooseBtn       = document.getElementById('chooseFactorBtn');
  const actionSwitches  = document.querySelectorAll('.actionSwitch');
  const note            = document.getElementById('oneFactorNote');
  const activateBtn     = document.getElementById('activateOneFactor');

  // Modal – výběr faktoru
  const factorModal  = document.getElementById("factorModal");
  const cancelFactor = document.getElementById("cancelFactor");
  const factorItems  = document.querySelectorAll(".factor-item");

  // Modal – SMS
  const smsModal   = document.getElementById('smsModal');
  const smsCode    = document.getElementById('smsCode');
  const smsError   = document.getElementById('smsError');
  const smsCancel  = document.getElementById('smsCancel');
  const smsConfirm = document.getElementById('smsConfirm');

  // Stav
  let oneFactorEnabled = false;
  let selectedFactor   = null;

  function lockBox(locked){
    onefactorBox.classList.toggle('disabled', locked);
    chooseBtn.disabled = locked;
    actionSwitches.forEach(i => { i.disabled = locked; });
    activateBtn.disabled = true; // jistota
  }

  function resetSelection(){
    selectedFactor = null;
    chooseBtn.textContent = "Vybrat faktor";
    note.style.display = oneFactorEnabled ? 'block' : 'none';
    actionSwitches.forEach(i => { i.checked = false; i.disabled = true; });
    updateActivateState();
  }

  function enableActionsIfFactorChosen(){
    const enable = !!selectedFactor;
    actionSwitches.forEach(i => { i.disabled = !enable; if(!enable) i.checked = false; });
    note.style.display = enable ? 'none' : 'block';
    updateActivateState();
  }

  // maximálně 1 akční přepínač
  actionSwitches.forEach(sw => {
    sw.addEventListener('change', (e)=>{
      if(e.target.checked){
        actionSwitches.forEach(o=>{ if(o!==e.target) o.checked=false; });
      }
      updateActivateState();
    });
  });

  // podmínka pro povolení tlačítka Aktivovat
  function updateActivateState(){
    const anyActionOn = Array.from(actionSwitches).some(i=>i.checked);
    activateBtn.disabled = !(oneFactorEnabled && selectedFactor && anyActionOn);
  }

  // toggle ON/OFF
  oneFactorToggle.addEventListener('change', (e)=>{
    oneFactorEnabled = e.target.checked;
    if(oneFactorEnabled){
      lockBox(false);
      resetSelection(); // vynutit nový výběr
    }else{
      lockBox(true);
      resetSelection();
    }
  });

  // výběr faktoru (modal)
  chooseBtn.addEventListener("click", () => { if(!chooseBtn.disabled) { factorModal.style.display = "flex"; }});
  cancelFactor.addEventListener("click", () => { factorModal.style.display = "none"; });

  factorItems.forEach(item => {
    item.addEventListener("click", () => {
      selectedFactor = item.textContent.trim();
      chooseBtn.textContent = "Vybraný faktor: " + selectedFactor;
      factorModal.style.display = "none";
      enableActionsIfFactorChosen();
    });
  });

  // Aktivovat jednofaktor -> SMS modal
  activateBtn.addEventListener('click', ()=>{
    if(activateBtn.disabled) return;
    smsError.style.display = 'none';
    smsCode.value = '';
    smsModal.style.display = 'flex';
    setTimeout(()=> smsCode.focus(), 50);
  });

  smsCancel.addEventListener('click', ()=> smsModal.style.display = 'none');
  smsConfirm.addEventListener('click', ()=>{
    if(smsCode.value.trim() === '123456'){
      smsError.style.display = 'none';
      smsModal.style.display = 'none';
      alert('Jednofaktorové ověření aktivováno: ' + selectedFactor);
      // tady by v reálu proběhlo uložení na server
    }else{
      smsError.style.display = 'block';
    }
  });

  // INIT
  lockBox(true);
  resetSelection();
</script>
</body>
</html>
